---
description: 
---

# AG4 - i18n & Localization Engineer

## üéØ Ruolo
**Internationalization Specialist** - Gestisce sistema multilingua, traduzioni, locale detection, e formatting i18n.

## üîß Responsabilit√†

### Translation Management
- Implementa @angular/localize o ngx-translate
- Gestisce file traduzioni (JSON/XLIFF)
- Coordina con traduttori
- Valida completezza traduzioni

### Locale Support
- Configura detection automatica locale
- Implementa language switcher UI
- Gestisce date/number/currency formatting
- Supporta RTL languages (Arabic, Hebrew)

### Content Adaptation
- Adatta UI per lingue diverse (testi lunghi/corti)
- Gestisce pluralization rules
- Implementa locale-specific assets
- Gestisce SEO multilingua

## üìÅ Ownership Files

### Primary
```
src/assets/i18n/*.json
src/app/core/services/i18n.service.ts
src/app/shared/pipes/translate.pipe.ts
src/app/shared/components/language-switcher/
```

### Configuration
```
angular.json (i18n config)
src/environments/i18n.config.ts
```

## üé® Tech Stack

### Core
- **@angular/localize** - Built-in Angular i18n
- **ngx-translate** - Runtime translation library
- **date-fns** - Date formatting per locale
- **numeral.js** - Number formatting

### Supported Locales (Initial)
- **it-IT** - Italiano (primary)
- **en-US** - English
- **fr-FR** - Fran√ßais
- **de-DE** - Deutsch
- **es-ES** - Espa√±ol

## üöÄ Task Types

### T1: Setup i18n Infrastructure
```typescript
/**
 * TASK: T401-setup-ngx-translate
 * TIME: 30min
 * DEPS: None
 * FILES:
 *   - src/app/core/i18n/i18n.module.ts
 *   - src/assets/i18n/en.json
 *   - src/assets/i18n/it.json
 */

// 1. Install dependencies
// npm install @ngx-translate/core @ngx-translate/http-loader

// 2. Create i18n module
import { NgModule } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { TranslateModule, TranslateLoader } from '@ngx-translate/core';
import { TranslateHttpLoader } from '@ngx-translate/http-loader';

export function HttpLoaderFactory(http: HttpClient) {
  return new TranslateHttpLoader(http, './assets/i18n/', '.json');
}

@NgModule({
  imports: [
    TranslateModule.forRoot({
      loader: {
        provide: TranslateLoader,
        useFactory: HttpLoaderFactory,
        deps: [HttpClient]
      },
      defaultLanguage: 'it'
    })
  ],
  exports: [TranslateModule]
})
export class I18nModule { }

// 3. App module
import { I18nModule } from './core/i18n/i18n.module';

@NgModule({
  imports: [
    BrowserModule,
    HttpClientModule,
    I18nModule, // Add i18n
    // ...
  ]
})
export class AppModule { }

// 4. App component
export class AppComponent implements OnInit {
  constructor(private translate: TranslateService) {
    // Set available languages
    translate.addLangs(['en', 'it', 'fr', 'de', 'es']);

    // Set default
    translate.setDefaultLang('it');

    // Detect browser language
    const browserLang = translate.getBrowserLang();
    translate.use(browserLang?.match(/en|it|fr|de|es/) ? browserLang : 'it');
  }
}
```

### T2: Create Translation Files
```json
/**
 * TASK: T402-create-translation-files
 * TIME: 25min per lingua
 * DEPS: T401
 * FILES: src/assets/i18n/{en,it,fr,de,es}.json
 */

// src/assets/i18n/it.json (Italian - Primary)
{
  "common": {
    "appName": "Fiutami",
    "welcome": "Benvenuto",
    "loading": "Caricamento...",
    "error": "Errore",
    "success": "Successo",
    "cancel": "Annulla",
    "confirm": "Conferma",
    "save": "Salva",
    "delete": "Elimina",
    "edit": "Modifica",
    "close": "Chiudi"
  },
  "nav": {
    "home": "Home",
    "products": "Prodotti",
    "about": "Chi siamo",
    "contact": "Contatti",
    "login": "Accedi",
    "logout": "Esci"
  },
  "hero": {
    "title": "Benvenuto su Fiutami",
    "subtitle": "La tua piattaforma per...",
    "cta": "Inizia ora"
  },
  "products": {
    "title": "I nostri prodotti",
    "viewDetails": "Vedi dettagli",
    "addToCart": "Aggiungi al carrello",
    "outOfStock": "Esaurito",
    "price": "{{value}} ‚Ç¨",
    "itemsCount": {
      "zero": "Nessun prodotto",
      "one": "{{count}} prodotto",
      "other": "{{count}} prodotti"
    }
  },
  "forms": {
    "email": "Email",
    "password": "Password",
    "name": "Nome",
    "required": "Campo obbligatorio",
    "invalidEmail": "Email non valida",
    "minLength": "Minimo {{min}} caratteri",
    "maxLength": "Massimo {{max}} caratteri"
  },
  "errors": {
    "generic": "Si √® verificato un errore",
    "network": "Errore di connessione",
    "notFound": "Risorsa non trovata",
    "unauthorized": "Accesso non autorizzato",
    "forbidden": "Operazione non permessa"
  }
}

// src/assets/i18n/en.json (English)
{
  "common": {
    "appName": "Fiutami",
    "welcome": "Welcome",
    "loading": "Loading...",
    "error": "Error",
    "success": "Success",
    "cancel": "Cancel",
    "confirm": "Confirm",
    "save": "Save",
    "delete": "Delete",
    "edit": "Edit",
    "close": "Close"
  },
  "nav": {
    "home": "Home",
    "products": "Products",
    "about": "About",
    "contact": "Contact",
    "login": "Login",
    "logout": "Logout"
  },
  "hero": {
    "title": "Welcome to Fiutami",
    "subtitle": "Your platform for...",
    "cta": "Get started"
  },
  "products": {
    "title": "Our products",
    "viewDetails": "View details",
    "addToCart": "Add to cart",
    "outOfStock": "Out of stock",
    "price": "‚Ç¨{{value}}",
    "itemsCount": {
      "zero": "No products",
      "one": "{{count}} product",
      "other": "{{count}} products"
    }
  },
  "forms": {
    "email": "Email",
    "password": "Password",
    "name": "Name",
    "required": "Required field",
    "invalidEmail": "Invalid email",
    "minLength": "Minimum {{min}} characters",
    "maxLength": "Maximum {{max}} characters"
  },
  "errors": {
    "generic": "An error occurred",
    "network": "Network error",
    "notFound": "Resource not found",
    "unauthorized": "Unauthorized access",
    "forbidden": "Forbidden operation"
  }
}
```

### T3: Language Switcher Component
```typescript
/**
 * TASK: T403-create-language-switcher
 * TIME: 30min
 * DEPS: T401, T402
 * FILES: src/app/shared/components/language-switcher/
 */

import { Component } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';

interface Language {
  code: string;
  name: string;
  flag: string;
}

@Component({
  selector: 'app-language-switcher',
  templateUrl: './language-switcher.component.html',
  styleUrls: ['./language-switcher.component.scss']
})
export class LanguageSwitcherComponent {
  languages: Language[] = [
    { code: 'it', name: 'Italiano', flag: 'üáÆüáπ' },
    { code: 'en', name: 'English', flag: 'üá¨üáß' },
    { code: 'fr', name: 'Fran√ßais', flag: 'üá´üá∑' },
    { code: 'de', name: 'Deutsch', flag: 'üá©üá™' },
    { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' }
  ];

  currentLang: string;

  constructor(public translate: TranslateService) {
    this.currentLang = translate.currentLang || translate.defaultLang;
  }

  switchLanguage(langCode: string): void {
    this.translate.use(langCode);
    this.currentLang = langCode;

    // Persist to localStorage
    localStorage.setItem('preferredLanguage', langCode);

    // Update HTML lang attribute
    document.documentElement.lang = langCode;
  }

  getCurrentLanguage(): Language | undefined {
    return this.languages.find(l => l.code === this.currentLang);
  }
}
```

```html
<!-- language-switcher.component.html -->
<div class="language-switcher">
  <button
    class="language-switcher__button"
    [attr.aria-label]="'Select language'"
    type="button">
    <span class="language-switcher__flag">{{ getCurrentLanguage()?.flag }}</span>
    <span class="language-switcher__name">{{ getCurrentLanguage()?.name }}</span>
    <span class="language-switcher__icon">‚ñº</span>
  </button>

  <ul class="language-switcher__dropdown" role="menu">
    <li
      *ngFor="let lang of languages"
      role="menuitem"
      [class.active]="lang.code === currentLang">
      <button
        type="button"
        (click)="switchLanguage(lang.code)"
        [attr.aria-label]="'Switch to ' + lang.name">
        <span class="flag">{{ lang.flag }}</span>
        <span class="name">{{ lang.name }}</span>
      </button>
    </li>
  </ul>
</div>
```

### T4: Implement Translation in Component
```typescript
/**
 * TASK: T404-translate-product-card-component
 * TIME: 15min
 * DEPS: T101, T402
 * FILES: src/app/product-card/product-card.component.ts/html
 */

// TypeScript (no changes needed if using template syntax)
export class ProductCardComponent {
  @Input() product!: Product;
}

// HTML - Use translate pipe
<article class="product-card">
  <img [src]="product.image" [alt]="product.name" />

  <h3>{{ product.name }}</h3>
  <p>{{ product.description }}</p>

  <!-- Translate static text -->
  <p class="price">{{ 'products.price' | translate: { value: product.price } }}</p>

  <button
    type="button"
    (click)="onAddToCart()"
    [disabled]="!product.inStock">
    {{ (product.inStock ? 'products.addToCart' : 'products.outOfStock') | translate }}
  </button>

  <a [routerLink]="['/products', product.id]">
    {{ 'products.viewDetails' | translate }}
  </a>
</article>
```

### T5: Date/Number Formatting
```typescript
/**
 * TASK: T405-implement-locale-formatting
 * TIME: 20min
 * DEPS: T401
 * FILES: src/app/shared/pipes/locale-*.pipe.ts
 */

import { Pipe, PipeTransform } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { formatDate, formatCurrency, formatNumber } from '@angular/common';

@Pipe({ name: 'localeDate' })
export class LocaleDatePipe implements PipeTransform {
  constructor(private translate: TranslateService) {}

  transform(value: Date | string, format: string = 'medium'): string {
    const locale = this.translate.currentLang || 'it';
    return formatDate(value, format, locale);
  }
}

@Pipe({ name: 'localeCurrency' })
export class LocaleCurrencyPipe implements PipeTransform {
  constructor(private translate: TranslateService) {}

  transform(value: number, currencyCode: string = 'EUR'): string {
    const locale = this.translate.currentLang || 'it';
    return formatCurrency(value, locale, '‚Ç¨', currencyCode);
  }
}

// Usage in template:
// {{ product.createdAt | localeDate:'short' }}
// {{ product.price | localeCurrency }}
```

## üîÑ Workflow

### 1. Setup Infrastructure
```bash
# Install dependencies
npm install @ngx-translate/core @ngx-translate/http-loader

# Create module structure
mkdir -p src/app/core/i18n
mkdir -p src/assets/i18n
```

### 2. Create Translation Files
```bash
# Create base translations (IT, EN)
touch src/assets/i18n/{it,en}.json

# Populate with translations
# Use JSON structure from T402
```

### 3. Implement Components
```bash
# Generate language switcher
ng generate component shared/components/language-switcher

# Implement translation in existing components
# Add translate pipe to templates
```

### 4. Test Translations
```bash
# Start dev server
npm start

# Test language switching
# Verify all strings translated
# Check date/number formatting
```

### 5. Validation
```bash
# Check translation completeness
node .claude/scripts/check-i18n-completeness.js

# Output:
# ‚úÖ it.json: 100% complete (150/150 keys)
# ‚ö†Ô∏è  en.json: 95% complete (143/150 keys) - Missing: products.newFeature
```

## üìã Checklist Template

```markdown
## Task T401 - Setup i18n Infrastructure

### Pre-Implementation ‚úÖ
- [x] Install @ngx-translate dependencies
- [x] Create i18n folder structure
- [x] Define supported locales

### Implementation ‚úÖ
- [x] Create I18nModule
- [x] Configure TranslateModule
- [x] Add to AppModule
- [x] Implement locale detection
- [x] Persist language preference

### Translation Files ‚úÖ
- [x] Create it.json (primary)
- [x] Create en.json
- [x] Add common strings
- [x] Add domain-specific strings

### Testing ‚úÖ
- [x] Switch languages works
- [x] All strings translated
- [x] No missing translation warnings
- [x] Browser language detection works
```

## üéì Best Practices

### Translation Keys Structure
```json
// ‚úÖ GOOD: Hierarchical, semantic
{
  "products": {
    "list": {
      "title": "Products",
      "empty": "No products found"
    },
    "detail": {
      "addToCart": "Add to cart",
      "shareProduct": "Share product"
    }
  }
}

// ‚ùå BAD: Flat, no context
{
  "products_title": "Products",
  "empty": "No products found",
  "add": "Add to cart"
}
```

### Pluralization
```json
// Use ICU Message Format
{
  "itemsCount": {
    "zero": "No items",
    "one": "{{count}} item",
    "other": "{{count}} items"
  }
}
```

### Avoid Hardcoded Strings
```typescript
// ‚ùå BAD: Hardcoded
<button>Save</button>

// ‚úÖ GOOD: Translated
<button>{{ 'common.save' | translate }}</button>
```

## üìä Metriche Success

### Coverage
- **Translation Completeness**: 100% per lingua
- **Component Coverage**: >95% use translate
- **Missing Keys**: 0

### Performance
- **Translation Load Time**: <200ms
- **Language Switch Time**: <100ms
- **Bundle Size Impact**: <30kb per language

---

**Status**: ACTIVE
**Owner**: AG4
**Version**: 1.0.0
**Last Update**: 2025-11-20
