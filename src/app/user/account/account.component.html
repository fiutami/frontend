<div class="account">
  <h1 class="account__title">Account</h1>
  <p class="account__subtitle">Gestisci il tuo account e i tuoi dati</p>

  <!-- Account Overview -->
  <section class="account__section">
    <h2 class="account__section-title">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      Panoramica Account
    </h2>

    <div class="account__info-grid">
      <div class="account__info-item">
        <span class="account__info-label">Email</span>
        <span class="account__info-value">{{ user?.email }}</span>
      </div>
      <div class="account__info-item">
        <span class="account__info-label">Tipo Account</span>
        <span class="account__info-value">{{ user?.provider === 'google' ? 'Google' : 'Email' }}</span>
      </div>
      <div class="account__info-item">
        <span class="account__info-label">Data Registrazione</span>
        <span class="account__info-value">{{ user?.createdAt | date:'dd MMMM yyyy' }}</span>
      </div>
      <div class="account__info-item">
        <span class="account__info-label">Stato Account</span>
        <span class="account__info-value account__info-value--active">
          <span class="account__status-dot"></span>
          Attivo
        </span>
      </div>
    </div>
  </section>

  <!-- Data Management -->
  <section class="account__section">
    <h2 class="account__section-title">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
      Gestione Dati
    </h2>

    <p class="account__section-desc">
      In conformità con il GDPR, puoi esportare tutti i tuoi dati personali in qualsiasi momento.
    </p>

    <button type="button" class="btn btn--outline" (click)="openExportModal()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
      Esporta i miei dati
    </button>
  </section>

  <!-- Danger Zone -->
  <section class="account__section account__section--danger">
    <h2 class="account__section-title account__section-title--danger">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
        <line x1="12" y1="9" x2="12" y2="13"></line>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg>
      Zona Pericolosa
    </h2>

    <div class="account__danger-box">
      <div class="account__danger-info">
        <strong>Elimina Account</strong>
        <p>
          Una volta eliminato, il tuo account e tutti i dati associati verranno rimossi permanentemente
          dopo un periodo di grazia di 30 giorni. Questa azione non può essere annullata.
        </p>
      </div>
      <button type="button" class="btn btn--danger" (click)="openDeleteConfirm()">
        Elimina Account
      </button>
    </div>
  </section>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteConfirm" (click)="closeDeleteConfirm()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal__header">
      <h3 class="modal__title">Conferma Eliminazione Account</h3>
      <button type="button" class="modal__close" (click)="closeDeleteConfirm()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal__body">
      <div class="modal__warning">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
      </div>

      <p class="modal__text">
        Stai per richiedere l'eliminazione del tuo account. Questa azione:
      </p>

      <ul class="modal__list">
        <li>Avvierà un periodo di grazia di 30 giorni</li>
        <li>Durante questo periodo potrai annullare la richiesta effettuando il login</li>
        <li>Dopo 30 giorni, tutti i tuoi dati verranno eliminati definitivamente</li>
        <li>Non potrai più accedere ai servizi con questo account</li>
      </ul>

      <div class="modal__confirm-input">
        <label for="deleteConfirmInput">Per confermare, digita <strong>elimina</strong> nel campo sottostante:</label>
        <input
          id="deleteConfirmInput"
          type="text"
          [(ngModel)]="deleteConfirmText"
          placeholder="elimina"
          class="form-input"
          autocomplete="off"
        >
      </div>

      <div class="modal__error" *ngIf="deleteError">
        {{ deleteError }}
      </div>
    </div>

    <div class="modal__footer">
      <button type="button" class="btn btn--ghost" (click)="closeDeleteConfirm()">
        Annulla
      </button>
      <button
        type="button"
        class="btn btn--danger"
        [disabled]="!canDelete || isDeleting"
        (click)="confirmDelete()"
      >
        {{ isDeleting ? 'Eliminazione in corso...' : 'Elimina il mio account' }}
      </button>
    </div>
  </div>
</div>

<!-- Export Data Modal -->
<div class="modal-overlay" *ngIf="showExportModal" (click)="closeExportModal()">
  <div class="modal modal--small" (click)="$event.stopPropagation()">
    <div class="modal__header">
      <h3 class="modal__title">Esporta Dati</h3>
      <button type="button" class="modal__close" (click)="closeExportModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal__body">
      <div class="modal__icon" *ngIf="!exportSuccess">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      </div>

      <div class="modal__success" *ngIf="exportSuccess">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
      </div>

      <p class="modal__text" *ngIf="!exportSuccess">
        Esporteremo tutti i tuoi dati personali in formato JSON. Questo include:
      </p>

      <ul class="modal__list" *ngIf="!exportSuccess">
        <li>Informazioni del profilo</li>
        <li>Impostazioni account</li>
        <li>Cronologia sessioni</li>
        <li>Log attività</li>
      </ul>

      <p class="modal__text modal__text--success" *ngIf="exportSuccess">
        I tuoi dati sono stati esportati con successo! Il download dovrebbe essere iniziato automaticamente.
      </p>
    </div>

    <div class="modal__footer">
      <button type="button" class="btn btn--ghost" (click)="closeExportModal()" *ngIf="!exportSuccess">
        Annulla
      </button>
      <button
        type="button"
        class="btn btn--primary"
        [disabled]="isExporting"
        (click)="exportData()"
        *ngIf="!exportSuccess"
      >
        {{ isExporting ? 'Esportazione...' : 'Esporta Dati' }}
      </button>
      <button
        type="button"
        class="btn btn--primary"
        (click)="closeExportModal()"
        *ngIf="exportSuccess"
      >
        Chiudi
      </button>
    </div>
  </div>
</div>
