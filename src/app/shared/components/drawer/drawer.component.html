<!-- Backdrop overlay -->
<div
  class="drawer-backdrop"
  [@fadeInOut]="isOpen ? 'open' : 'closed'"
  (click)="onBackdropClick()"
  aria-hidden="true"
></div>

<!-- Drawer panel -->
<aside
  class="drawer"
  [@slideInOut]="isOpen ? 'open' : 'closed'"
  role="dialog"
  aria-modal="true"
  [attr.aria-label]="'drawer.title' | translate"
  [attr.data-viewport]="viewportSize()"
  data-testid="drawer-container"
>
  <!-- Header Figma: freccia + logo + sottotitolo + avatar pet -->
  <header class="drawer__header">
    <!-- Freccia indietro (chiude e torna a Home) -->
    <button
      class="drawer__back-btn"
      (click)="closeAndGoHome()"
      aria-label="Chiudi e torna alla Home"
      type="button"
    >
      <span class="material-icons">arrow_back</span>
    </button>

    <!-- Logo + Sottotitolo centrati -->
    <div class="drawer__branding">
      <img src="assets/Logo/fiutami.svg" alt="FIUTAMI" class="drawer__logo" />
      <p class="drawer__subtitle">Impostazioni e attivit√†</p>
    </div>

    <!-- Avatar pet -->
    <div class="drawer__pet-avatar">
      @if (activePetPhotoUrl()) {
        <img [src]="activePetPhotoUrl()" [alt]="activePetName()" />
      } @else {
        <span class="drawer__pet-placeholder">üêæ</span>
      }
    </div>
  </header>

  <!-- Language Selector -->
  <div class="drawer__language-section">
    <button
      class="drawer__language-button"
      (click)="toggleLanguageDropdown()"
      type="button"
      [attr.aria-expanded]="showLanguageDropdown"
      aria-label="Cambia lingua"
    >
      <span class="drawer__language-icon material-icons">language</span>
      <span class="drawer__language-current">
        <span class="drawer__language-flag">{{ currentLanguage.flag }}</span>
        <span class="drawer__language-label">{{ currentLanguage.label }}</span>
      </span>
      <span class="material-icons drawer__language-chevron" [class.drawer__language-chevron--open]="showLanguageDropdown">
        expand_more
      </span>
    </button>

    @if (showLanguageDropdown) {
      <div class="drawer__language-dropdown">
        @for (lang of languages; track lang.code) {
          <button
            class="drawer__language-option"
            [class.drawer__language-option--active]="lang.code === currentLang"
            (click)="onLanguageChange(lang.code)"
            type="button"
          >
            <span class="drawer__language-flag">{{ lang.flag }}</span>
            <span>{{ lang.label }}</span>
            @if (lang.code === currentLang) {
              <span class="material-icons drawer__language-check">check</span>
            }
          </button>
        }
      </div>
    }
  </div>

  <!-- Menu sections -->
  <nav class="drawer__nav" aria-label="Menu principale">
    @for (section of menuSections; track $index; let isLast = $last) {
      <ul class="drawer__menu">
        @for (item of section.items; track item.labelKey) {
          <li class="drawer__menu-item" [class.drawer__menu-item--logout]="item.isLogout">
            <button
              class="drawer__menu-button"
              [class.drawer__menu-button--logout]="item.isLogout"
              (click)="onMenuItemClick(item)"
              type="button"
            >
              @if (item.icon) {
                <span class="drawer__menu-icon material-icons">{{ item.icon }}</span>
              }
              <span class="drawer__menu-label">{{ item.labelKey | translate }}</span>
              <svg class="drawer__menu-arrow" width="8" height="14" viewBox="0 0 8 14" fill="currentColor">
                <path d="M1.5 1L7 7L1.5 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
              </svg>
            </button>
          </li>
        }
      </ul>
      @if (!isLast) {
        <div class="drawer__separator"></div>
      }
    }
  </nav>
</aside>
