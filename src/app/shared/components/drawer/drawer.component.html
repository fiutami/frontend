<!-- Backdrop overlay -->
<div
  class="drawer-backdrop"
  [@fadeInOut]="isOpen ? 'open' : 'closed'"
  (click)="onBackdropClick()"
  aria-hidden="true"
></div>

<!-- Drawer panel -->
<aside
  class="drawer"
  [@slideInOut]="isOpen ? 'open' : 'closed'"
  role="dialog"
  aria-modal="true"
  aria-label="Menu di navigazione"
  [attr.data-viewport]="viewportSize()"
  data-testid="drawer-container"
>
  <!-- Close button (top right) -->
  <button
    class="drawer__close"
    (click)="close()"
    aria-label="Chiudi menu"
    type="button"
  >
    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
      <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
    </svg>
  </button>

  <!-- Header with title -->
  <header class="drawer__header">
    <h1 class="drawer__title">FiutaMi</h1>
    <p class="drawer__subtitle">{{ 'drawer.subtitle' | translate }}</p>
  </header>

  <!-- Search bar -->
  <div class="drawer__search">
    <svg class="drawer__search-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
      <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    </svg>
    <input
      type="text"
      class="drawer__search-input"
      [placeholder]="'common.search' | translate"
      [value]="searchQuery"
      (input)="onSearchChange($event)"
      aria-label="Cerca nel menu"
    />
  </div>

  <!-- Menu sections -->
  <nav class="drawer__nav" aria-label="Menu principale">
    @for (section of menuSections; track $index; let isLast = $last) {
      <ul class="drawer__menu">
        @for (item of section.items; track item.labelKey) {
          <li class="drawer__menu-item" [class.drawer__menu-item--logout]="item.isLogout">
            <button
              class="drawer__menu-button"
              [class.drawer__menu-button--logout]="item.isLogout"
              (click)="onMenuItemClick(item)"
              type="button"
            >
              <span class="drawer__menu-label">{{ item.labelKey | translate }}</span>
              <svg class="drawer__menu-arrow" width="8" height="14" viewBox="0 0 8 14" fill="currentColor">
                <path d="M1.5 1L7 7L1.5 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
              </svg>
            </button>
          </li>
        }
      </ul>
      @if (!isLast) {
        <div class="drawer__separator"></div>
      }
    }
  </nav>

  <!-- Footer with language selector and version -->
  <footer class="drawer__footer">
    <!-- Language selector -->
    <div class="drawer__language">
      <button
        class="drawer__language-button"
        (click)="toggleLanguageDropdown()"
        type="button"
        [attr.aria-expanded]="showLanguageDropdown"
      >
        <span class="drawer__language-flag">{{ currentLanguage.flag }}</span>
        <span class="drawer__language-label">{{ currentLanguage.label }}</span>
        <svg
          class="drawer__language-chevron"
          [class.drawer__language-chevron--open]="showLanguageDropdown"
          width="12"
          height="8"
          viewBox="0 0 12 8"
          fill="currentColor"
        >
          <path d="M1.5 1.5L6 6L10.5 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </svg>
      </button>

      <!-- Language dropdown -->
      @if (showLanguageDropdown) {
        <div class="drawer__language-dropdown">
          @for (lang of languages; track lang.code) {
            <button
              class="drawer__language-option"
              [class.drawer__language-option--active]="lang.code === currentLang"
              (click)="onLanguageChange(lang.code)"
              type="button"
            >
              <span class="drawer__language-flag">{{ lang.flag }}</span>
              <span>{{ lang.label }}</span>
            </button>
          }
        </div>
      }
    </div>

    <!-- App version -->
    <p class="drawer__version">v{{ appVersion }}</p>
  </footer>
</aside>
