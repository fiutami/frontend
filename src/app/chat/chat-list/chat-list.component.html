<div class="chat-list-container">
  <!-- Header -->
  <div class="header">
    <button class="back-button" (click)="goBack()">
      <svg width="34" height="34" viewBox="0 0 34 34" fill="none">
        <circle cx="17" cy="17" r="17" fill="white"/>
        <path d="M20 11L14 17L20 23" stroke="#4A74F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <h1 class="title">{{ 'chat.title' | translate }}</h1>
  </div>

  <!-- Search Bar -->
  <div class="search-container">
    <div class="search-bar">
      <svg class="search-icon" width="17" height="17" viewBox="0 0 17 17" fill="none">
        <circle cx="7.5" cy="7.5" r="6.5" stroke="#4A74F0" stroke-width="2"/>
        <path d="M12 12L16 16" stroke="#4A74F0" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <input
        type="text"
        class="search-input"
        [placeholder]="'common.search' | translate"
        [(ngModel)]="searchQuery"
        (input)="onSearch()"
      />
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="isEmpty">
    <div class="empty-content">
      <p class="empty-text">{{ 'chat.empty.title' | translate }}</p>
      <div class="mascot-container">
        <div class="speech-bubble">
          <span>{{ 'chat.empty.mascotMessage' | translate }}</span>
        </div>
        <img src="assets/images/mascot/fiuto.svg" alt="Fiuto" class="mascot" />
      </div>
    </div>
  </div>

  <!-- Conversations List -->
  <div class="conversations-wrapper" *ngIf="!isEmpty">
    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="action-btn delete-btn">
        <svg width="13" height="18" viewBox="0 0 13 18" fill="none">
          <path d="M1 4H12M10.5 4V15C10.5 16 9.5 17 8.5 17H4.5C3.5 17 2.5 16 2.5 15V4M4 4V3C4 2 5 1 6 1H7C8 1 9 2 9 3V4" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="action-btn bookmark-btn">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M5 3H15V17L10 13L5 17V3Z" stroke="#4A74F0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="action-btn new-message-btn" (click)="startNewMessage()">
        {{ 'chat.newMessage' | translate }}
      </button>
    </div>

    <!-- Recent Contacts -->
    <div class="section">
      <span class="section-label">{{ 'chat.recentContacts' | translate }}</span>
      <div class="recent-contacts">
        <div class="contact" *ngFor="let contact of recentContacts" (click)="openConversation(contact.id)">
          <div class="contact-avatar">
            <img [src]="contact.avatar" [alt]="contact.name" onerror="this.src='assets/images/avatars/default.png'" />
          </div>
          <span class="contact-name">{{ contact.name }}</span>
        </div>
      </div>
    </div>

    <!-- Today Messages -->
    <div class="section" *ngIf="todayConversations.length > 0">
      <span class="section-label today-label">{{ 'chat.todayMessages' | translate }}</span>
      <div class="conversation-list">
        <div
          class="conversation-item"
          *ngFor="let conv of todayConversations"
          (click)="openConversation(conv.id)"
        >
          <div class="avatar-container">
            <img [src]="conv.recipientAvatar" [alt]="conv.recipientName" class="avatar" onerror="this.src='assets/images/avatars/default.png'" />
            <span class="online-indicator" *ngIf="conv.isOnline"></span>
          </div>
          <div class="conversation-content">
            <div class="conversation-header">
              <span class="recipient-name">{{ conv.recipientName }}</span>
              <span class="message-time">{{ formatTime(conv.lastMessageTime) }}</span>
            </div>
            <div class="message-preview">
              <span class="last-message">{{ conv.lastMessage }}</span>
              <span class="unread-badge" *ngIf="conv.unreadCount > 0">{{ conv.unreadCount }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Yesterday Messages -->
    <div class="section" *ngIf="yesterdayConversations.length > 0">
      <span class="section-label">{{ 'chat.yesterdayMessages' | translate }}</span>
      <div class="conversation-list">
        <div
          class="conversation-item"
          *ngFor="let conv of yesterdayConversations"
          (click)="openConversation(conv.id)"
        >
          <div class="avatar-container">
            <img [src]="conv.recipientAvatar" [alt]="conv.recipientName" class="avatar" onerror="this.src='assets/images/avatars/default.png'" />
            <span class="online-indicator" *ngIf="conv.isOnline"></span>
          </div>
          <div class="conversation-content">
            <div class="conversation-header">
              <span class="recipient-name">{{ conv.recipientName }}</span>
              <span class="message-time">{{ formatTime(conv.lastMessageTime) }}</span>
            </div>
            <div class="message-preview">
              <span class="last-message">{{ conv.lastMessage }}</span>
              <span class="unread-badge" *ngIf="conv.unreadCount > 0">{{ conv.unreadCount }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Older Messages -->
    <div class="section" *ngIf="olderConversations.length > 0">
      <span class="section-label">{{ 'chat.olderMessages' | translate }}</span>
      <div class="conversation-list">
        <div
          class="conversation-item"
          *ngFor="let conv of olderConversations"
          (click)="openConversation(conv.id)"
        >
          <div class="avatar-container">
            <img [src]="conv.recipientAvatar" [alt]="conv.recipientName" class="avatar" onerror="this.src='assets/images/avatars/default.png'" />
            <span class="online-indicator" *ngIf="conv.isOnline"></span>
          </div>
          <div class="conversation-content">
            <div class="conversation-header">
              <span class="recipient-name">{{ conv.recipientName }}</span>
              <span class="message-time">{{ formatTime(conv.lastMessageTime) }}</span>
            </div>
            <div class="message-preview">
              <span class="last-message">{{ conv.lastMessage }}</span>
              <span class="unread-badge" *ngIf="conv.unreadCount > 0">{{ conv.unreadCount }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
