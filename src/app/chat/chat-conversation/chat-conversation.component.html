<div class="chat-conversation-container">
  <!-- Header -->
  <div class="header">
    <div class="header-background"></div>
    <div class="header-content">
      <button class="back-button" (click)="goBack()">
        <svg width="34" height="34" viewBox="0 0 34 34" fill="none">
          <circle cx="17" cy="17" r="17" fill="white"/>
          <path d="M20 11L14 17L20 23" stroke="#4A74F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <div class="recipient-info">
        <div class="avatar-container">
          <img [src]="recipient.recipientAvatar" [alt]="recipient.recipientName" class="avatar" onerror="this.src='assets/images/avatars/default.png'" />
        </div>
        <div class="recipient-details">
          <span class="recipient-name">{{ recipient.recipientName }}</span>
          <div class="status-container">
            <span class="online-indicator" *ngIf="recipient.isOnline"></span>
            <span class="status-text">{{ recipient.isOnline ? 'On line' : 'Offline' }}</span>
          </div>
        </div>
      </div>

      <div class="header-actions">
        <button class="action-btn" (click)="openCall()">
          <svg width="14" height="20" viewBox="0 0 14 20" fill="none">
            <path d="M13 14.5V17.5C13 18.0523 12.5523 18.5 12 18.5H2C1.44772 18.5 1 18.0523 1 17.5V2.5C1 1.94772 1.44772 1.5 2 1.5H12C12.5523 1.5 13 1.94772 13 2.5V5.5" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="7" cy="16" r="1" fill="white"/>
          </svg>
        </button>
        <button class="action-btn" (click)="openMenu()">
          <svg width="22" height="17" viewBox="0 0 22 17" fill="none">
            <circle cx="4" cy="8.5" r="2" fill="white"/>
            <circle cx="11" cy="8.5" r="2" fill="white"/>
            <circle cx="18" cy="8.5" r="2" fill="white"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Messages Area -->
  <div class="messages-container" #messagesContainer>
    <ng-container *ngFor="let message of messages; let i = index">
      <!-- Date Separator -->
      <div class="date-separator" *ngIf="shouldShowDateSeparator(i)">
        <span>{{ formatMessageDate(message.createdAt) }}</span>
      </div>

      <!-- Message Bubble -->
      <div class="message-row" [class.mine]="message.isMine" [class.other]="!message.isMine">
        <div class="avatar-wrapper" *ngIf="!message.isMine">
          <img [src]="recipient.recipientAvatar" class="message-avatar" alt="" onerror="this.src='assets/images/avatars/default.png'" />
          <span class="avatar-online" *ngIf="recipient.isOnline"></span>
        </div>

        <div class="message-bubble" [class.mine]="message.isMine" [class.other]="!message.isMine">
          <span class="message-text">{{ message.text }}</span>
        </div>
      </div>
    </ng-container>

    <!-- Typing Indicator -->
    <div class="typing-indicator" *ngIf="isTyping">
      <span>{{ 'chat.typing' | translate }}</span>
    </div>
  </div>

  <!-- Input Area -->
  <div class="input-area">
    <button class="input-btn attach-btn" (click)="attachFile()">
      <svg width="19" height="18" viewBox="0 0 19 18" fill="none">
        <path d="M17 9L9.5 16.5C7.5 18.5 4 18.5 2 16.5C0 14.5 0 11 2 9L10 1C11.5 -0.5 14 -0.5 15.5 1C17 2.5 17 5 15.5 6.5L7 15C6 16 4.5 16 3.5 15C2.5 14 2.5 12.5 3.5 11.5L11 4" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
    </button>
    <button class="input-btn camera-btn" (click)="openCamera()">
      <svg width="19" height="19" viewBox="0 0 19 19" fill="none">
        <circle cx="9.5" cy="10.5" r="4" stroke="white" stroke-width="1.5"/>
        <path d="M1 6.5V15.5C1 16.5 2 17.5 3 17.5H16C17 17.5 18 16.5 18 15.5V6.5C18 5.5 17 4.5 16 4.5H14L13 2.5C12.5 1.5 11.5 1.5 11 1.5H8C7.5 1.5 6.5 1.5 6 2.5L5 4.5H3C2 4.5 1 5.5 1 6.5Z" stroke="white" stroke-width="1.5"/>
      </svg>
    </button>

    <div class="input-wrapper">
      <input
        type="text"
        class="message-input"
        [placeholder]="'chat.placeholder' | translate"
        [(ngModel)]="newMessage"
        (keypress)="onKeyPress($event)"
      />
    </div>

    <button class="input-btn record-btn" (click)="recordVoice()">
      <svg width="50" height="50" viewBox="0 0 50 50" fill="none">
        <circle cx="25" cy="25" r="25" fill="url(#recordGradient)"/>
        <path d="M25 32L25 18M25 18L19 24M25 18L31 24" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <defs>
          <linearGradient id="recordGradient" x1="25" y1="0" x2="25" y2="50" gradientUnits="userSpaceOnUse">
            <stop stop-color="#4A74F0"/>
            <stop offset="1" stop-color="#4A74F0"/>
          </linearGradient>
        </defs>
      </svg>
    </button>
  </div>
</div>
