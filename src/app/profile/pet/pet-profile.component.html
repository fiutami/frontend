<app-tab-page-shell-pet-profile
  title="Profilo"
  activeTabId="pet-profile"
  [showBack]="true"
  (backClicked)="goBack()">

  <!-- Foto nel cerchio bianco -->
  <div shellPetPhoto class="pet-photo">
    @if (isLoading()) {
      <div class="pet-photo__placeholder">
        <span class="pet-photo__spinner"></span>
      </div>
    } @else if (photoUrl()) {
      <img
        [src]="photoUrl()"
        [alt]="petName()"
        class="pet-photo__img" />
    } @else {
      <div class="pet-photo__placeholder">
        <span>{{ petName().charAt(0) || '?' }}</span>
      </div>
    }
  </div>

  <!-- Sticky content: nome + razza -->
  <ng-container shellStickyContent>
    @if (pet(); as p) {
      <div class="pet-header">
        <h1 class="pet-header__name">{{ p.name }}</h1>
        <p class="pet-header__breed">{{ petSubtitle() }}</p>
      </div>
    } @else if (error()) {
      <div class="pet-header">
        <p class="pet-header__breed">{{ error()! | translate }}</p>
      </div>
    }
  </ng-container>

  <!-- Main content (dentro la card blu) -->
  <div class="pet-content">
    @if (isLoading()) {
      <div class="pet-content__loading">
        <div class="pet-content__spinner"></div>
      </div>
    } @else if (error()) {
      <div class="pet-content__error">
        <p>{{ error()! | translate }}</p>
        <button class="pet-content__retry" (click)="goBack()">
          {{ 'common.back' | translate }}
        </button>
      </div>
    }
    @if (!isLoading() && !error() && pet()) {
      <!-- Step 2: info row -->
      <section class="pet-info-row">
        <app-pet-info-card [items]="petInfoItems()" layout="horizontal" variant="solid" />
      </section>

      <!-- Step 3: feature CTA buttons -->
      <section class="pet-cta-row">
        <app-profile-icon
          icon="foto"
          variant="cta"
          ariaLabel="Banda Pelosa"
          (onClick)="onGalleryClick()" />
        <app-profile-icon
          icon="friends"
          variant="cta"
          ariaLabel="Rullino Feroce"
          (onClick)="onFriendsClick()" />
        <app-profile-icon
          icon="doc"
          variant="cta"
          ariaLabel="Fatti Bestiali"
          (onClick)="onFactsClick()" />
      </section>

      <!-- Step 4: map button -->
      <section class="pet-map">
        <div class="pet-map__container">
          <div class="pet-map__placeholder">
            <span>Mappa</span>
          </div>
          <button class="pet-map__fiuta-btn" (click)="onFiutaClick()">
            FIUTA
          </button>
        </div>
      </section>
    }
  </div>

</app-tab-page-shell-pet-profile>
