<div class="forgot-password-confirm">
  <!-- Background Image with Overlay - Optimized with responsive WebP/AVIF -->
  <div class="forgot-password-confirm__background">
    <picture>
      <!-- AVIF: Best compression with responsive sizes (14-57KB vs 1.4MB PNG) -->
      <source
        srcset="assets/images/auth-bg-480w.avif 480w,
                assets/images/auth-bg-768w.avif 768w,
                assets/images/auth-bg-1280w.avif 1280w,
                assets/images/auth-bg.avif 1920w"
        sizes="100vw"
        type="image/avif">
      <!-- WebP: Wide support with responsive sizes -->
      <source
        srcset="assets/images/auth-bg-480w.webp 480w,
                assets/images/auth-bg-768w.webp 768w,
                assets/images/auth-bg-1280w.webp 1280w,
                assets/images/auth-bg.webp 1920w"
        sizes="100vw"
        type="image/webp">
      <!-- PNG: Fallback -->
      <img
        src="assets/images/auth-bg.png"
        alt=""
        class="forgot-password-confirm__background-image"
        role="presentation"
        loading="eager"
        fetchpriority="high"
        decoding="async" />
    </picture>
    <div class="forgot-password-confirm__overlay" aria-hidden="true"></div>
  </div>

  <!-- Back Button (Top-Left) -->
  <app-icon-button
    class="forgot-password-confirm__back"
    variant="glass"
    ariaLabel="Torna indietro"
    (clicked)="onBackClick()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
  </app-icon-button>

  <!-- Main Content -->
  <div class="forgot-password-confirm__content">
    <app-auth-card>
      <form [formGroup]="confirmForm" (ngSubmit)="onSubmit()" class="forgot-password-confirm__form">
        <h2 class="forgot-password-confirm__title">Nuova Password</h2>
        <p class="forgot-password-confirm__description">
          Scegli una nuova password per il tuo account.
        </p>

        <!-- Password Input -->
        <app-form-input
          label="Nuova Password"
          type="password"
          formControlName="password"
          placeholder="inserisci la nuova password"
          autocomplete="new-password"
          [hasError]="!!(password?.invalid && password?.touched)"
          [errorMessage]="getPasswordError()">
        </app-form-input>

        <!-- Confirm Password Input -->
        <app-form-input
          label="Conferma Password"
          type="password"
          formControlName="confirmPassword"
          placeholder="conferma la nuova password"
          autocomplete="new-password"
          [hasError]="!!(confirmPassword?.invalid && confirmPassword?.touched) || !!(confirmForm.errors?.['passwordMismatch'] && confirmPassword?.touched)"
          [errorMessage]="getConfirmPasswordError()">
        </app-form-input>

        <!-- Submit Button -->
        <app-button
          variant="primary"
          type="submit"
          [fullWidth]="true"
          [disabled]="confirmForm.invalid"
          [loading]="isSubmitting">
          Reimposta Password
        </app-button>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="forgot-password-confirm__error" role="alert">
          {{ errorMessage }}
        </div>
      </form>
    </app-auth-card>
  </div>
</div>
