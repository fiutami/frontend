<div class="forgot-password-code">
  <!-- Background Image with Overlay - Optimized with responsive WebP/AVIF -->
  <div class="forgot-password-code__background">
    <picture>
      <!-- AVIF: Best compression with responsive sizes (14-57KB vs 1.4MB PNG) -->
      <source
        srcset="assets/images/auth-bg-480w.avif 480w,
                assets/images/auth-bg-768w.avif 768w,
                assets/images/auth-bg-1280w.avif 1280w,
                assets/images/auth-bg.avif 1920w"
        sizes="100vw"
        type="image/avif">
      <!-- WebP: Wide support with responsive sizes -->
      <source
        srcset="assets/images/auth-bg-480w.webp 480w,
                assets/images/auth-bg-768w.webp 768w,
                assets/images/auth-bg-1280w.webp 1280w,
                assets/images/auth-bg.webp 1920w"
        sizes="100vw"
        type="image/webp">
      <!-- PNG: Fallback -->
      <img
        src="assets/images/auth-bg.png"
        alt=""
        class="forgot-password-code__background-image"
        role="presentation"
        loading="eager"
        fetchpriority="high"
        decoding="async" />
    </picture>
    <div class="forgot-password-code__overlay" aria-hidden="true"></div>
  </div>

  <!-- Back Button (Top-Left) -->
  <app-icon-button
    class="forgot-password-code__back"
    variant="glass"
    ariaLabel="Torna indietro"
    (clicked)="onBackClick()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
  </app-icon-button>

  <!-- Main Content -->
  <div class="forgot-password-code__content">
    <app-auth-card>
      <form [formGroup]="codeForm" (ngSubmit)="onSubmit()" class="forgot-password-code__form">
        <h2 class="forgot-password-code__title">Verifica Codice</h2>
        <p class="forgot-password-code__description">
          Abbiamo inviato un codice a 6 cifre a <strong>{{ email }}</strong>. Inseriscilo qui sotto.
        </p>

        <!-- Code Input -->
        <app-form-input
          label="Codice"
          type="text"
          formControlName="code"
          placeholder="000000"
          autocomplete="one-time-code"
          inputmode="numeric"
          maxlength="6"
          [hasError]="!!(code?.invalid && code?.touched)"
          [errorMessage]="getCodeError()">
        </app-form-input>

        <!-- Resend Code Link -->
        <div class="forgot-password-code__resend">
          <button
            type="button"
            class="forgot-password-code__resend-link"
            (click)="onResendCode()"
            [disabled]="isResending">
            {{ isResending ? 'Invio in corso...' : 'Non hai ricevuto il codice? Invia di nuovo' }}
          </button>
        </div>

        <!-- Submit Button -->
        <app-button
          variant="primary"
          type="submit"
          [fullWidth]="true"
          [disabled]="codeForm.invalid"
          [loading]="isSubmitting">
          Verifica Codice
        </app-button>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="forgot-password-code__error" role="alert">
          {{ errorMessage }}
        </div>
      </form>
    </app-auth-card>
  </div>
</div>
