<app-tab-page-shell-default
  title="Breed Finder"
  backgroundVariant="blue-solid"
  activeTabId="home"
  [showBack]="true"
  (backClicked)="goBack()">

  <!-- Sticky Content: Search Bar -->
  <div shellStickyContent class="finder-sticky">
    <div class="search-bar">
      <span class="material-icons search-bar__icon">search</span>
      <input
        type="text"
        class="search-bar__input"
        placeholder="Cerca una razza..."
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)"
        (keyup.enter)="onSearch()">
      <button class="search-bar__mic" aria-label="Ricerca vocale">
        <span class="material-icons">mic</span>
      </button>
    </div>
  </div>

  <!-- Selected Species Badge -->
  @if (selectedSpeciesName()) {
    <div class="species-badge">
      <span class="material-icons">pets</span>
      <span>{{ selectedSpeciesName() }}</span>
      <button (click)="selectedSpeciesId.set(null)" aria-label="Rimuovi filtro">
        <span class="material-icons">close</span>
      </button>
    </div>
  }

  <!-- Photo Upload Area -->
  <section class="upload-section">
    <h2 class="upload-section__title">Carica una foto</h2>
    <p class="upload-section__desc">Scatta o carica una foto del tuo pet per identificare la razza</p>

    @if (!photoPreview()) {
      <!-- Upload placeholder -->
      <label class="upload-area" for="photo-input">
        <input
          type="file"
          id="photo-input"
          accept="image/*"
          capture="environment"
          (change)="onFileSelected($event)"
          class="upload-area__input">
        <div class="upload-area__content">
          <span class="material-icons upload-area__icon">add_a_photo</span>
          <span class="upload-area__text">Tocca per caricare</span>
          <span class="upload-area__hint">JPG, PNG - max 10MB</span>
        </div>
      </label>
    } @else {
      <!-- Photo preview -->
      <div class="photo-preview">
        <img [src]="photoPreview()" alt="Foto caricata" class="photo-preview__image">
        <button class="photo-preview__remove" (click)="removePhoto()" aria-label="Rimuovi foto">
          <span class="material-icons">close</span>
        </button>
      </div>
    }
  </section>

  <!-- Description Field -->
  <section class="description-section">
    <label for="pet-description" class="description-section__label">
      Descrivi il tuo pet (opzionale)
    </label>
    <textarea
      id="pet-description"
      class="description-section__input"
      placeholder="Es: pelo lungo, orecchie a punta, taglia media..."
      [ngModel]="description()"
      (ngModelChange)="description.set($event)"
      rows="3">
    </textarea>
  </section>

  <!-- Analyze Button -->
  <button
    class="analyze-button"
    [disabled]="!canAnalyze()"
    (click)="analyzePhoto()">
    @if (isAnalyzing()) {
      <span class="analyze-button__progress">
        <span class="analyze-button__spinner"></span>
        <span>Analisi in corso... {{ analysisProgress() | number:'1.0-0' }}%</span>
      </span>
    } @else {
      <span class="material-icons">auto_awesome</span>
      <span>Identifica la razza</span>
    }
  </button>

  <!-- Analysis Progress -->
  @if (isAnalyzing()) {
    <div class="analysis-progress">
      <div class="analysis-progress__bar">
        <div
          class="analysis-progress__fill"
          [style.width.%]="analysisProgress()">
        </div>
      </div>
      <p class="analysis-progress__text">
        L'AI sta analizzando la foto...
      </p>
    </div>
  }

</app-tab-page-shell-default>
