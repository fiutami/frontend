<app-tab-page-shell-default
  title="Risultato"
  backgroundVariant="blue-solid"
  activeTabId="home"
  [showBack]="true"
  (backClicked)="goBack()">

  <!-- Loading state -->
  @if (isLoading()) {
    <div class="result-loading">
      <div class="result-loading__spinner"></div>
      <p>Caricamento dettagli...</p>
    </div>
  }

  <!-- Error state -->
  @if (error()) {
    <div class="result-error">
      <span class="material-icons">error_outline</span>
      <p>{{ error() }}</p>
      <button class="result-error__retry" (click)="goBack()">
        Torna indietro
      </button>
    </div>
  }

  <!-- Breed details -->
  @if (breed() && !isLoading()) {
    <!-- Breed Image & Name -->
    <section class="breed-hero">
      <div class="breed-hero__image-container">
        <img
          [src]="breed()!.imageUrl"
          [alt]="breed()!.name"
          class="breed-hero__image"
          (error)="$any($event.target).src='/assets/placeholder-breed.svg'">
      </div>

      <h2 class="breed-hero__name">{{ breed()!.name }}</h2>

      <!-- Badges -->
      <div class="breed-hero__badges">
        <span class="badge badge--origin">
          <span class="material-icons">place</span>
          {{ breed()!.origin }}
        </span>
        <span class="badge badge--recognition">
          <span class="material-icons">verified</span>
          {{ breed()!.recognition }}
        </span>
      </div>
    </section>

    <!-- Info Sections -->
    <section class="info-sections">
      @for (section of infoSections(); track trackBySection($index, section)) {
        @if (getSectionContent(section.id)) {
          <div
            class="info-card"
            [class.info-card--expanded]="isSectionExpanded(section.id)">
            <button
              class="info-card__header"
              (click)="toggleSection(section.id)"
              [attr.aria-expanded]="isSectionExpanded(section.id)">
              <span class="info-card__icon">
                <span class="material-icons">{{ section.icon }}</span>
              </span>
              <span class="info-card__title">{{ section.title }}</span>
              <span class="material-icons info-card__chevron">
                {{ isSectionExpanded(section.id) ? 'expand_less' : 'expand_more' }}
              </span>
            </button>

            @if (isSectionExpanded(section.id)) {
              <div class="info-card__content">
                @if (section.id === 'rituals' || section.id === 'health') {
                  <!-- List content -->
                  <ul class="info-card__list">
                    @for (item of getSectionContent(section.id); track item) {
                      <li>{{ item }}</li>
                    }
                  </ul>
                } @else {
                  <!-- Text content -->
                  <p class="info-card__text">{{ getSectionContent(section.id) }}</p>
                }
              </div>
            }
          </div>
        }
      }
    </section>

    <!-- Action Buttons -->
    <section class="result-actions">
      <button class="result-actions__primary" (click)="goToFinder()">
        <span class="material-icons">photo_camera</span>
        <span>Analizza un'altra foto</span>
      </button>
      <button class="result-actions__secondary" (click)="goBack()">
        <span class="material-icons">grid_view</span>
        <span>Esplora altre specie</span>
      </button>
    </section>
  }

</app-tab-page-shell-default>
