<!-- Usa TabPageShellDefault: Avatar, Logo, MascotPeek, TabBar sono automatici -->
<app-tab-page-shell-default
  title="Specie"
  activeTabId="breeds"
  [showBack]="true"
  (backClicked)="goBack()">

  <!-- Frecce navigazione ai lati del titolo (dentro blu) -->
  <div shellBrandingExtra class="breeds-title-nav">
    <button class="breeds-title-nav__btn breeds-title-nav__btn--prev" aria-label="Sezione precedente">
      <span class="material-icons">chevron_left</span>
    </button>
    <button class="breeds-title-nav__btn breeds-title-nav__btn--next" aria-label="Sezione successiva">
      <span class="material-icons">chevron_right</span>
    </button>
  </div>

  <!-- Sticky Content (su giallo): Frase + Search -->
  <ng-container shellStickyContent>
    <!-- Intro text -->
    <div class="breeds-intro">
      <h2 class="breeds-intro__title">Fiuta e scopri</h2>
      <p class="breeds-intro__subtitle">Ogni specie racconta qualcosa.</p>
    </div>

    <!-- Search box -->
    <div class="breeds-search">
      <span class="material-icons breeds-search__icon">search</span>
      <input
        type="text"
        class="breeds-search__input"
        placeholder="Cosa stai cercando"
        [value]="searchQuery()"
        (input)="onSearch($event)">
      <button class="breeds-search__filter" aria-label="Filtri">
        <span class="material-icons">tune</span>
      </button>
    </div>
  </ng-container>

  <!-- Main Content -->
  <!-- Loading state -->
  @if (isLoading()) {
    <div class="breeds-loading">
      <div class="breeds-loading__spinner"></div>
      <p>Caricamento specie...</p>
    </div>
  }

  <!-- Species Grid / Carousel -->
  @if (!isLoading() && speciesList().length > 0) {
    <section class="species-section">
      <div class="species-carousel">
        <!-- Carousel controls (visible on larger screens) -->
        <button
          class="species-carousel__nav species-carousel__nav--prev"
          (click)="prevSlide()"
          [disabled]="isAnimating()"
          aria-label="Specie precedenti">
          <span class="material-icons">chevron_left</span>
        </button>

        <!-- Species cards grid -->
        <div class="species-grid" [class.species-grid--animating]="isAnimating()">
          @for (species of speciesList(); track trackBySpecies($index, species)) {
            <button
              class="species-card"
              [class.species-card--selected]="selectedSpecies()?.id === species.id"
              (click)="selectSpecies(species)"
              [attr.aria-label]="'Seleziona ' + species.name">
              <div class="species-card__image">
                <img
                  [src]="species.imageUrl"
                  [alt]="species.name"
                  loading="lazy"
                  (error)="$any($event.target).src='/assets/placeholder-species.svg'">
                <div class="species-card__overlay"></div>
              </div>
              <div class="species-card__content">
                <span class="species-card__name" [class.species-card__name--small]="species.name.length > 8">{{ species.name }}</span>
              </div>
            </button>
          }
        </div>

        <button
          class="species-carousel__nav species-carousel__nav--next"
          (click)="nextSlide()"
          [disabled]="isAnimating()"
          aria-label="Specie successive">
          <span class="material-icons">chevron_right</span>
        </button>
      </div>

      <!-- Carousel indicators -->
      <div class="species-carousel__indicators">
        @for (species of speciesList(); track species.id; let i = $index) {
          <button
            class="species-carousel__dot"
            [class.species-carousel__dot--active]="i === carouselIndex()"
            (click)="carouselIndex.set(i)"
            [attr.aria-label]="'Vai a ' + species.name">
          </button>
        }
      </div>
    </section>

    <!-- AI Finder CTA -->
    <section class="finder-cta">
      <button class="finder-cta__button" (click)="goToFinder()">
        <span class="material-icons">photo_camera</span>
        <span>Scopri la razza con una foto</span>
      </button>
    </section>
  }

  <!-- Empty state -->
  @if (!isLoading() && speciesList().length === 0) {
    <div class="breeds-empty">
      <span class="material-icons breeds-empty__icon">pets</span>
      <p>Nessuna specie disponibile</p>
    </div>
  }

</app-tab-page-shell-default>
