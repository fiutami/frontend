<div class="chat-list">
  <!-- Header -->
  <header class="chat-list__header">
    <button
      class="chat-list__back-btn"
      (click)="goBack()"
      aria-label="Torna indietro"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
    </button>

    <h1 class="chat-list__title">Messaggi</h1>

    <div class="chat-list__header-actions">
      <button
        class="chat-list__search-btn"
        aria-label="Cerca"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
      </button>
      <button
        class="chat-list__menu-btn"
        (click)="openDrawer()"
        aria-label="Apri menu"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Conversations List -->
  <main class="chat-list__content">
    @if (!hasConversations()) {
      <!-- Empty state -->
      <div class="chat-list__empty">
        <div class="chat-list__empty-illustration">
          <svg width="120" height="120" viewBox="0 0 200 200" fill="none">
            <circle cx="100" cy="100" r="80" fill="#F5F5F5"/>
            <path
              d="M60 80C60 71.7157 66.7157 65 75 65H125C133.284 65 140 71.7157 140 80V110C140 118.284 133.284 125 125 125H90L70 140V125C63.3726 125 60 121.627 60 115V80Z"
              fill="#F5A623"
            />
            <circle cx="85" cy="92" r="5" fill="white"/>
            <circle cx="100" cy="92" r="5" fill="white"/>
            <circle cx="115" cy="92" r="5" fill="white"/>
          </svg>
        </div>
        <h2 class="chat-list__empty-title">Nessun messaggio</h2>
        <p class="chat-list__empty-text">
          Inizia a chattare con altri pet owner!
        </p>
        <button class="chat-list__find-btn" (click)="findFriends()">
          Trova amici
        </button>
      </div>
    } @else {
      <ul class="chat-list__list">
        @for (conversation of conversations(); track conversation.id) {
          <li class="chat-list__item" (click)="openConversation(conversation.id)">
            <div class="chat-list__avatar">
              @if (conversation.recipientAvatar) {
                <img
                  [src]="conversation.recipientAvatar"
                  [alt]="conversation.recipientName"
                  class="chat-list__avatar-img"
                />
              } @else {
                <div class="chat-list__avatar-placeholder">
                  {{ getAvatarPlaceholder(conversation.recipientName) }}
                </div>
              }
              @if (conversation.isOnline) {
                <span class="chat-list__online-dot"></span>
              }
            </div>

            <div class="chat-list__info">
              <div class="chat-list__top-row">
                <span class="chat-list__name">{{ conversation.recipientName }}</span>
                <span class="chat-list__time">{{ formatTime(conversation.lastMessageTime) }}</span>
              </div>
              <div class="chat-list__bottom-row">
                <p class="chat-list__message">{{ conversation.lastMessage }}</p>
                @if (conversation.unreadCount > 0) {
                  <span class="chat-list__badge">{{ conversation.unreadCount }}</span>
                }
              </div>
            </div>
          </li>
        }
      </ul>
    }
  </main>

  <!-- Bottom Tab Bar -->
  <app-bottom-tab-bar [tabs]="tabs" [activeTabId]="'chat'"></app-bottom-tab-bar>
</div>
