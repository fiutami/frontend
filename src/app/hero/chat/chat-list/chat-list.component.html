<app-tab-page-shell-default
  title="Messaggi"
  backgroundVariant="tab-menu"
  activeTabId="chat"
  [showBack]="true"
  (backClicked)="goBack()">

  <!-- Conversations List -->
  @if (!hasConversations()) {
    <!-- Empty state -->
    <div class="chat-list__empty">
      <div class="chat-list__empty-illustration">
        <svg width="120" height="120" viewBox="0 0 200 200" fill="none">
          <circle cx="100" cy="100" r="80" fill="#F5F5F5"/>
          <path
            d="M60 80C60 71.7157 66.7157 65 75 65H125C133.284 65 140 71.7157 140 80V110C140 118.284 133.284 125 125 125H90L70 140V125C63.3726 125 60 121.627 60 115V80Z"
            fill="#F5A623"
          />
          <circle cx="85" cy="92" r="5" fill="white"/>
          <circle cx="100" cy="92" r="5" fill="white"/>
          <circle cx="115" cy="92" r="5" fill="white"/>
        </svg>
      </div>
      <h2 class="chat-list__empty-title">Nessun messaggio</h2>
      <p class="chat-list__empty-text">
        Inizia a chattare con altri pet owner!
      </p>
      <button class="chat-list__find-btn" (click)="findFriends()">
        Trova amici
      </button>
    </div>
  } @else {
    <ul class="chat-list__list">
      @for (conversation of conversations(); track conversation.id) {
        <li class="chat-list__item" (click)="openConversation(conversation.id)">
          <div class="chat-list__avatar">
            @if (conversation.recipientAvatar) {
              <img
                [src]="conversation.recipientAvatar"
                [alt]="conversation.recipientName"
                class="chat-list__avatar-img"
              />
            } @else {
              <div class="chat-list__avatar-placeholder">
                {{ getAvatarPlaceholder(conversation.recipientName) }}
              </div>
            }
            @if (conversation.isOnline) {
              <span class="chat-list__online-dot"></span>
            }
          </div>

          <div class="chat-list__info">
            <div class="chat-list__top-row">
              <span class="chat-list__name">{{ conversation.recipientName }}</span>
              <span class="chat-list__time">{{ formatTime(conversation.lastMessageTime) }}</span>
            </div>
            <div class="chat-list__bottom-row">
              <p class="chat-list__message">{{ conversation.lastMessage }}</p>
              @if (conversation.unreadCount > 0) {
                <span class="chat-list__badge">{{ conversation.unreadCount }}</span>
              }
            </div>
          </div>
        </li>
      }
    </ul>
  }

</app-tab-page-shell-default>
