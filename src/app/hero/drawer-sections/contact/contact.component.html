<div class="contact-page">
  <!-- Header -->
  <header class="contact-header">
    <button
      class="contact-header__back"
      (click)="goBack()"
      aria-label="Torna indietro"
      type="button">
      <span class="material-icons">arrow_back</span>
    </button>
    <h1 class="contact-header__title">{{ title }}</h1>
  </header>

  <!-- Content -->
  <main class="contact-content">
    <!-- Success State -->
    @if (isSuccess()) {
      <div class="contact-success">
        <div class="contact-success__icon">
          <span class="material-icons">check_circle</span>
        </div>
        <h2 class="contact-success__title">Messaggio Inviato!</h2>
        <p class="contact-success__text">{{ successResponse()?.message }}</p>
        @if (successResponse()?.ticketId) {
          <p class="contact-success__ticket">
            Numero ticket: <strong>{{ successResponse()?.ticketId }}</strong>
          </p>
        }
        <button
          class="contact-success__btn"
          (click)="resetForm()"
          type="button">
          Invia un altro messaggio
        </button>
      </div>
    } @else {
      <!-- Intro -->
      <div class="contact-intro">
        <span class="material-icons contact-intro__icon">support_agent</span>
        <p class="contact-intro__text">
          Hai domande, suggerimenti o problemi? Siamo qui per aiutarti!
          Compila il modulo e ti risponderemo il prima possibile.
        </p>
      </div>

      <!-- Error Banner -->
      @if (hasError()) {
        <div class="contact-error" role="alert">
          <span class="material-icons">error_outline</span>
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <!-- Form -->
      <form class="contact-form" [formGroup]="contactForm" (ngSubmit)="onSubmit()">
        <!-- Name Field -->
        <div class="form-group" [class.form-group--error]="isFieldInvalid('name')">
          <label for="name" class="form-group__label">
            Nome completo <span class="required">*</span>
          </label>
          <input
            type="text"
            id="name"
            formControlName="name"
            class="form-group__input"
            placeholder="Il tuo nome"
            autocomplete="name"
            aria-describedby="name-error"
          />
          @if (isFieldInvalid('name')) {
            <span id="name-error" class="form-group__error">
              {{ getFieldError('name') }}
            </span>
          }
        </div>

        <!-- Email Field -->
        <div class="form-group" [class.form-group--error]="isFieldInvalid('email')">
          <label for="email" class="form-group__label">
            Email <span class="required">*</span>
          </label>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="form-group__input"
            placeholder="tua@email.com"
            autocomplete="email"
            aria-describedby="email-error"
          />
          @if (isFieldInvalid('email')) {
            <span id="email-error" class="form-group__error">
              {{ getFieldError('email') }}
            </span>
          }
        </div>

        <!-- Subject Field -->
        <div class="form-group" [class.form-group--error]="isFieldInvalid('subject')">
          <label for="subject" class="form-group__label">
            Oggetto <span class="required">*</span>
          </label>
          <select
            id="subject"
            formControlName="subject"
            class="form-group__select"
            aria-describedby="subject-error">
            <option value="" disabled>Seleziona un argomento</option>
            @for (option of subjectOptions; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
          @if (isFieldInvalid('subject')) {
            <span id="subject-error" class="form-group__error">
              {{ getFieldError('subject') }}
            </span>
          }
        </div>

        <!-- Message Field -->
        <div class="form-group" [class.form-group--error]="isFieldInvalid('message')">
          <label for="message" class="form-group__label">
            Messaggio <span class="required">*</span>
          </label>
          <textarea
            id="message"
            formControlName="message"
            class="form-group__textarea"
            placeholder="Descrivi la tua richiesta..."
            rows="6"
            aria-describedby="message-error"
          ></textarea>
          @if (isFieldInvalid('message')) {
            <span id="message-error" class="form-group__error">
              {{ getFieldError('message') }}
            </span>
          }
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="contact-form__submit"
          [disabled]="isSubmitting()"
          [class.contact-form__submit--loading]="isSubmitting()">
          @if (isSubmitting()) {
            <span class="spinner"></span>
            <span>Invio in corso...</span>
          } @else {
            <span class="material-icons">send</span>
            <span>Invia Messaggio</span>
          }
        </button>
      </form>
    }
  </main>

</div>
