<app-tab-page-shell-drawer
  [title]="pageTitle"
  [showBack]="true"
  (backClicked)="goBack()">

  <!-- Content -->
  <main class="contact-content">
    <!-- Success State -->
    @if (isSuccess()) {
      <div class="contact-success">
        <div class="contact-success__icon">
          <span class="material-icons">check_circle</span>
        </div>
        <h2 class="contact-success__title">{{ 'drawerContact.successTitle' | translate }}</h2>
        <p class="contact-success__text">{{ successResponse()?.message }}</p>
        @if (successResponse()?.ticketId) {
          <p class="contact-success__ticket">
            {{ 'drawerContact.ticketLabel' | translate }} <strong>{{ successResponse()?.ticketId }}</strong>
          </p>
        }
        <button
          class="contact-success__btn"
          (click)="resetForm()"
          type="button">
          {{ 'drawerContact.sendAnother' | translate }}
        </button>
      </div>
    } @else {
      <!-- Intro -->
      <div class="contact-intro">
        <span class="material-icons contact-intro__icon">support_agent</span>
        <p class="contact-intro__text">
          {{ 'drawerContact.introText' | translate }}
        </p>
      </div>

      <!-- Support Options -->
      <div class="contact-support-options">
        @for (option of supportOptions; track option.labelKey) {
          <button
            class="contact-support-option"
            [class.contact-support-option--active]="selectedSupportOption() === option.labelKey"
            (click)="selectSupportOption(option.labelKey)"
            type="button">
            <span class="material-icons contact-support-option__icon">{{ option.icon }}</span>
            <span class="contact-support-option__label">{{ option.labelKey | translate }}</span>
          </button>
        }
      </div>

      <!-- Error Banner -->
      @if (hasError()) {
        <div class="contact-error" role="alert">
          <span class="material-icons">error_outline</span>
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <!-- Form -->
      <form class="contact-form" [formGroup]="contactForm" (ngSubmit)="onSubmit()">
        <!-- Name Field -->
        <div class="form-group" [class.form-group--error]="isFieldInvalid('name')">
          <label for="name" class="form-group__label">
            {{ 'drawerContact.labelName' | translate }} <span class="required">*</span>
          </label>
          <input
            type="text"
            id="name"
            formControlName="name"
            class="form-group__input"
            [placeholder]="'drawerContact.placeholderName' | translate"
            autocomplete="name"
            aria-describedby="name-error"
            maxlength="100"
          />
          @if (isFieldInvalid('name')) {
            <span id="name-error" class="form-group__error">
              {{ getFieldError('name') }}
            </span>
          }
        </div>

        <!-- Email Field -->
        <div class="form-group" [class.form-group--error]="isFieldInvalid('email')">
          <label for="email" class="form-group__label">
            {{ 'drawerContact.labelEmail' | translate }} <span class="required">*</span>
          </label>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="form-group__input"
            [placeholder]="'drawerContact.placeholderEmail' | translate"
            autocomplete="email"
            aria-describedby="email-error"
          />
          @if (isFieldInvalid('email')) {
            <span id="email-error" class="form-group__error">
              {{ getFieldError('email') }}
            </span>
          }
        </div>

        <!-- Subject Field -->
        <div class="form-group" [class.form-group--error]="isFieldInvalid('subject')">
          <label for="subject" class="form-group__label">
            {{ 'drawerContact.labelSubject' | translate }} <span class="required">*</span>
          </label>
          <select
            id="subject"
            formControlName="subject"
            class="form-group__select"
            aria-describedby="subject-error">
            <option value="" disabled>{{ 'drawerContact.placeholderSubject' | translate }}</option>
            @for (option of subjectOptions; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
          @if (isFieldInvalid('subject')) {
            <span id="subject-error" class="form-group__error">
              {{ getFieldError('subject') }}
            </span>
          }
        </div>

        <!-- Message Field -->
        <div class="form-group" [class.form-group--error]="isFieldInvalid('message')">
          <label for="message" class="form-group__label">
            {{ 'drawerContact.labelMessage' | translate }} <span class="required">*</span>
          </label>
          <textarea
            id="message"
            formControlName="message"
            class="form-group__textarea"
            [placeholder]="'drawerContact.placeholderMessage' | translate"
            rows="6"
            aria-describedby="message-error"
            maxlength="2000"
          ></textarea>
          @if (isFieldInvalid('message')) {
            <span id="message-error" class="form-group__error">
              {{ getFieldError('message') }}
            </span>
          }
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="contact-form__submit"
          [disabled]="isSubmitting()"
          [class.contact-form__submit--loading]="isSubmitting()">
          @if (isSubmitting()) {
            <span class="spinner"></span>
            <span>{{ 'drawerContact.submitting' | translate }}</span>
          } @else {
            <span class="material-icons">send</span>
            <span>{{ 'drawerContact.submit' | translate }}</span>
          }
        </button>
      </form>
    }
  </main>

</app-tab-page-shell-drawer>
