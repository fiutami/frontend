<app-tab-page-shell-drawer
  [title]="pageTitle"
  [showBack]="true"
  (backClicked)="goBack()">

  <!-- Content -->
  <div class="activity-content" [attr.data-viewport]="viewportSize()" data-testid="activity-page">
    <!-- Loading State -->
    @if (isLoading()) {
      <div class="activity-loading">
        <div class="activity-loading__spinner"></div>
        <p class="activity-loading__text">{{ 'drawerActivity.loading' | translate }}</p>
      </div>
    }

    <!-- Error State -->
    @else if (hasError()) {
      <div class="activity-error">
        <span class="material-icons activity-error__icon">error_outline</span>
        <p class="activity-error__text">{{ 'drawerActivity.error' | translate }}</p>
        <button class="activity-error__retry" (click)="retry()" type="button">
          {{ 'drawerActivity.retry' | translate }}
        </button>
      </div>
    }

    <!-- Empty State -->
    @else if (activities().length === 0) {
      <div class="activity-empty">
        <span class="material-icons activity-empty__icon">history</span>
        <p class="activity-empty__text">{{ 'drawerActivity.empty' | translate }}</p>
        <p class="activity-empty__subtext">{{ 'drawerActivity.emptySubtext' | translate }}</p>
      </div>
    }

    <!-- Activities List -->
    @else {
      <ul class="activity-list" role="list">
        @for (activity of activities(); track activity.id) {
          <li class="activity-item" [class]="getActivityTypeClass(activity.type)">
            <div class="activity-item__icon">
              <span class="material-icons">{{ activity.icon }}</span>
            </div>
            <div class="activity-item__content">
              <h3 class="activity-item__title">{{ activity.title }}</h3>
              <p class="activity-item__description">{{ activity.description }}</p>
              <time class="activity-item__time" [attr.datetime]="activity.timestamp.toISOString()">
                {{ formatTime(activity.timestamp) }}
              </time>
            </div>
          </li>
        }
      </ul>
    }

    <!-- Usage Time Section -->
    <section class="activity__section">
      <h2 class="activity__section-title">{{ 'drawerActivity.usageTime' | translate }}</h2>
      <div class="activity__usage-cards">
        <div class="activity__usage-card">
          <span class="activity__usage-value">12m</span>
          <span class="activity__usage-label">{{ 'drawerActivity.today' | translate }}</span>
        </div>
        <div class="activity__usage-card">
          <span class="activity__usage-value">1h 35m</span>
          <span class="activity__usage-label">{{ 'drawerActivity.thisWeek' | translate }}</span>
        </div>
        <div class="activity__usage-card">
          <span class="activity__usage-value">6h 20m</span>
          <span class="activity__usage-label">{{ 'drawerActivity.thisMonth' | translate }}</span>
        </div>
      </div>
    </section>

    <!-- Locked Sections -->
    <section class="activity__section">
      <app-locked-section-card
        [title]="'drawerActivity.searchHistory' | translate"
        icon="search">
      </app-locked-section-card>

      <app-locked-section-card
        [title]="'drawerActivity.quizFiutami' | translate"
        icon="quiz">
      </app-locked-section-card>
    </section>
  </div>

</app-tab-page-shell-drawer>
