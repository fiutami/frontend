<app-tab-page-shell-drawer
  [title]="pageTitle"
  [showBack]="true"
  (backClicked)="goBack()">

  <main class="invite-content">
    <!-- Loading State -->
    @if (isLoading()) {
      <div class="invite-loading">
        <div class="invite-loading__spinner"></div>
        <p class="invite-loading__text">{{ 'drawerInvite.loading' | translate }}</p>
      </div>
    }

    <!-- Error State -->
    @if (hasError() && !isLoading()) {
      <div class="invite-error">
        <span class="material-icons invite-error__icon">error_outline</span>
        <p class="invite-error__text">{{ 'drawerInvite.error' | translate }}</p>
        <button class="invite-error__retry" (click)="retry()">{{ 'drawerInvite.retry' | translate }}</button>
      </div>
    }

    @if (!isLoading() && !hasError()) {
      <!-- Intro Text -->
      <p class="invite-intro">{{ 'drawerInvite.heroDescription' | translate }}</p>

      <!-- Search Bar -->
      <div class="invite-search">
        <span class="material-icons invite-search__icon">search</span>
        <input
          type="text"
          class="invite-search__input"
          [placeholder]="'drawerInvite.searchPlaceholder' | translate"
          [value]="searchQuery()"
          (input)="searchQuery.set($any($event.target).value)" />
        @if (searchQuery()) {
          <button class="invite-search__clear" (click)="searchQuery.set('')">
            <span class="material-icons">close</span>
          </button>
        }
      </div>

      <!-- Section Title -->
      <div class="invite-section-title">
        <h3>{{ 'drawerInvite.contactList' | translate }}</h3>
        <div class="invite-section-title__line"></div>
      </div>

      <!-- Import + Manual Add -->
      <div class="invite-actions">
        @if (isContactPickerSupported()) {
          <button class="invite-actions__import" (click)="importContacts()">
            <span class="material-icons">contacts</span>
            {{ 'drawerInvite.importContacts' | translate }}
          </button>
        }
        <div class="invite-actions__manual">
          <input
            type="text"
            class="invite-actions__input"
            [placeholder]="'drawerInvite.namePlaceholder' | translate"
            [value]="manualName()"
            (input)="manualName.set($any($event.target).value)" />
          <input
            type="tel"
            class="invite-actions__input"
            [placeholder]="'drawerInvite.phonePlaceholder' | translate"
            [value]="manualPhone()"
            (input)="manualPhone.set($any($event.target).value)" />
          <button class="invite-actions__add" (click)="addManualContact()" [disabled]="!manualPhone().trim()">
            <span class="material-icons">person_add</span>
            {{ 'drawerInvite.add' | translate }}
          </button>
        </div>
      </div>

      <!-- Contact List -->
      @if (filteredContacts().length > 0) {
        <ul class="invite-list">
          @for (contact of filteredContacts(); track $index) {
            <li class="invite-contact">
              <div class="invite-contact__avatar">
                <span class="material-icons">person</span>
              </div>
              <div class="invite-contact__info">
                <span class="invite-contact__name">{{ contact.name }}</span>
                <span class="invite-contact__phone">{{ contact.phone }}</span>
              </div>
              <button class="invite-contact__send" (click)="confirmInvite(contact)">
                <span class="material-icons">send</span>
              </button>
              <button class="invite-contact__remove" (click)="removeContact($index)">
                <span class="material-icons">close</span>
              </button>
            </li>
          }
        </ul>
      } @else {
        <div class="invite-empty">
          <span class="material-icons">group_add</span>
          <p>{{ 'drawerInvite.emptyState' | translate }}</p>
        </div>
      }
    }
  </main>

  <!-- Confirm Dialog -->
  @if (showConfirmDialog()) {
    <div class="invite-dialog-overlay" (click)="cancelInvite()">
      <div class="invite-dialog" (click)="$event.stopPropagation()">
        <h3 class="invite-dialog__title">{{ 'drawerInvite.confirmTitle' | translate }}</h3>
        <p class="invite-dialog__text">
          {{ 'drawerInvite.confirmMessage' | translate:{ name: selectedContact()?.name } }}
        </p>
        <div class="invite-dialog__actions">
          <button class="invite-dialog__cancel" (click)="cancelInvite()">
            {{ 'drawerInvite.cancel' | translate }}
          </button>
          <button class="invite-dialog__send" (click)="sendWhatsAppInvite()">
            <span class="material-icons">send</span>
            WhatsApp
          </button>
        </div>
      </div>
    </div>
  }

</app-tab-page-shell-drawer>
