<div class="blocked-users-page">
  <header class="page-header">
    <button class="back-btn" (click)="goBack()" aria-label="Torna indietro">
      <span class="material-icons">arrow_back</span>
    </button>
    <h1>Utenti Bloccati</h1>
  </header>

  <main class="page-content">
    @if (isLoading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Caricamento...</p>
      </div>
    } @else if (hasError()) {
      <div class="error-state">
        <span class="material-icons">error_outline</span>
        <p>Errore nel caricamento</p>
        <button class="retry-btn" (click)="loadBlockedUsers()">Riprova</button>
      </div>
    } @else if (blockedUsers().length === 0) {
      <div class="empty-state">
        <span class="material-icons">person_off</span>
        <p>Nessun utente bloccato</p>
      </div>
    } @else {
      <div class="users-list">
        @for (user of blockedUsers(); track user.id) {
          <article class="user-card">
            <div class="user-avatar">
              @if (user.avatarUrl) {
                <img [src]="user.avatarUrl" [alt]="user.displayName" loading="lazy">
              } @else {
                <span class="initials">{{ getInitials(user.displayName) }}</span>
              }
            </div>
            <div class="user-info">
              <h3>{{ user.displayName }}</h3>
              <span class="username">{{'@'}}{{ user.username }}</span>
              <div class="blocked-info">
                <span class="blocked-date">Bloccato {{ formatBlockedDate(user.blockedAt) }}</span>
                @if (user.reason) {
                  <span class="blocked-reason">{{ user.reason }}</span>
                }
              </div>
            </div>
            <button class="unblock-btn" (click)="openUnblockConfirm(user)">
              <span class="material-icons">lock_open</span>
              Sblocca
            </button>
          </article>
        }
      </div>
    }
  </main>

  @if (showConfirmModal()) {
    <div class="modal-overlay" (click)="closeConfirmModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        @if (userToUnblock(); as user) {
          <div class="modal-body">
            <div class="confirm-icon">
              <span class="material-icons">person_add</span>
            </div>
            <h2>Sbloccare {{ user.displayName }}?</h2>
            <p>Questo utente potr√† nuovamente vedere i tuoi post, inviarti messaggi e interagire con te.</p>
          </div>
          <footer class="modal-footer">
            <button class="cancel-btn" (click)="closeConfirmModal()">Annulla</button>
            <button
              class="confirm-btn"
              (click)="confirmUnblock()"
              [disabled]="isUnblocking()"
            >
              @if (isUnblocking()) {
                <span class="btn-spinner"></span>
              } @else {
                Sblocca
              }
            </button>
          </footer>
        }
      </div>
    </div>
  }

</div>
