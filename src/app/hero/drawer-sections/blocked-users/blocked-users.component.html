<app-tab-page-shell-drawer
  [title]="pageTitle"
  [showBack]="true"
  (backClicked)="goBack()">

  <main class="page-content">
    @if (isLoading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>{{ 'drawerBlocked.loading' | translate }}</p>
      </div>
    } @else if (hasError()) {
      <div class="error-state">
        <span class="material-icons">error_outline</span>
        <p>{{ 'drawerBlocked.error' | translate }}</p>
        <button class="retry-btn" (click)="loadBlockedUsers()">{{ 'drawerBlocked.retry' | translate }}</button>
      </div>
    } @else if (blockedUsers().length === 0) {
      <div class="empty-state">
        <span class="material-icons">person_off</span>
        <p>{{ 'drawerBlocked.empty' | translate }}</p>
      </div>
    } @else {
      <div class="users-list">
        @for (user of blockedUsers(); track user.id) {
          <article class="user-card">
            <div class="user-avatar">
              @if (user.avatarUrl) {
                <img [src]="user.avatarUrl" [alt]="user.displayName" loading="lazy">
              } @else {
                <span class="initials">{{ getInitials(user.displayName) }}</span>
              }
            </div>
            <div class="user-info">
              <h3>{{ user.displayName }}</h3>
              <span class="username">{{'@'}}{{ user.username }}</span>
              <div class="blocked-info">
                <span class="blocked-date">{{ 'drawerBlocked.blockedPrefix' | translate }} {{ formatBlockedDate(user.blockedAt) }}</span>
                @if (user.reason) {
                  <span class="blocked-reason">{{ user.reason }}</span>
                }
              </div>
            </div>
            <button class="unblock-btn" (click)="openUnblockConfirm(user)">
              <span class="material-icons">lock_open</span>
              {{ 'drawerBlocked.unblock' | translate }}
            </button>
          </article>
        }
      </div>
    }
  </main>

  @if (showConfirmModal()) {
    <div class="modal-overlay" (click)="closeConfirmModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        @if (userToUnblock(); as user) {
          <div class="modal-body">
            <div class="confirm-icon">
              <span class="material-icons">person_add</span>
            </div>
            <h2>{{ 'drawerBlocked.confirmTitle' | translate: { name: user.displayName } }}</h2>
            <p>{{ 'drawerBlocked.confirmMessage' | translate }}</p>
          </div>
          <footer class="modal-footer">
            <button class="cancel-btn" (click)="closeConfirmModal()">{{ 'drawerBlocked.cancel' | translate }}</button>
            <button
              class="confirm-btn"
              (click)="confirmUnblock()"
              [disabled]="isUnblocking()"
            >
              @if (isUnblocking()) {
                <span class="btn-spinner"></span>
              } @else {
                {{ 'drawerBlocked.unblock' | translate }}
              }
            </button>
          </footer>
        }
      </div>
    </div>
  }

</app-tab-page-shell-drawer>
