<app-tab-page-shell-drawer
  [title]="pageTitle"
  [showBack]="true"
  (backClicked)="goBack()">

  <main class="page-content">
    <!-- Loading State -->
    @if (isLoading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>{{ 'drawerPetFriends.loading' | translate }}</p>
      </div>
    }

    <!-- Error State -->
    @else if (hasError()) {
      <div class="error-state">
        <span class="material-icons">error_outline</span>
        <p>{{ 'drawerPetFriends.error' | translate }}</p>
        <button class="retry-btn" (click)="retry()">{{ 'drawerPetFriends.retry' | translate }}</button>
      </div>
    }

    @else {
      <!-- Intro Text -->
      <p class="friends-intro">{{ 'drawerPetFriends.introText' | translate }}</p>

      <!-- Search Bar -->
      <div class="friends-search">
        <span class="material-icons friends-search__icon">search</span>
        <input
          type="text"
          class="friends-search__input"
          [placeholder]="'drawerPetFriends.searchPlaceholder' | translate"
          [value]="searchQuery()"
          (input)="searchQuery.set($any($event.target).value)" />
        @if (searchQuery()) {
          <button class="friends-search__clear" (click)="searchQuery.set('')">
            <span class="material-icons">close</span>
          </button>
        }
      </div>

      <!-- Section Title -->
      <div class="friends-section-title">
        <h3>{{ 'drawerPetFriends.title' | translate }}</h3>
        <div class="friends-section-title__line"></div>
      </div>

      <!-- Select Friends Button -->
      <button class="friends-select-btn" (click)="selectFriends()">
        <span class="material-icons">group_add</span>
        {{ 'drawerPetFriends.selectFriends' | translate }}
      </button>

      <!-- Friends List -->
      @if (filteredFriends().length > 0) {
        <ul class="friends-list">
          @for (friend of filteredFriends(); track friend.id) {
            <li class="friend-card" (click)="viewProfile(friend)">
              <div class="friend-card__avatar">
                @if (friend.userAvatar) {
                  <img [src]="friend.userAvatar" [alt]="friend.userName" loading="lazy" />
                } @else {
                  <span class="friend-card__initials">{{ getInitials(friend.userName) }}</span>
                }
              </div>
              <span class="friend-card__name">{{ friend.userName }}</span>
            </li>
          }
        </ul>
      } @else {
        <!-- Empty State -->
        <div class="empty-state">
          <span class="material-icons">group</span>
          <p>{{ 'drawerPetFriends.empty' | translate }}</p>
        </div>
      }
    }
  </main>

</app-tab-page-shell-drawer>
