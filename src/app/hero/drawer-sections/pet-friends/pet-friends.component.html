<app-tab-page-shell-blue
  [title]="pageTitle"
  activeTabId="home"
  [showBack]="true"
  (backClicked)="goBack()">

  <main class="page-content">
    <!-- Loading State -->
    @if (isLoading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>{{ 'drawerPetFriends.loading' | translate }}</p>
      </div>
    }

    <!-- Error State -->
    @else if (hasError()) {
      <div class="error-state">
        <span class="material-icons">error_outline</span>
        <p>{{ 'drawerPetFriends.error' | translate }}</p>
        <button class="retry-btn" (click)="retry()">{{ 'drawerPetFriends.retry' | translate }}</button>
      </div>
    }

    <!-- Empty State -->
    @else if (friends().length === 0) {
      <div class="empty-state">
        <span class="material-icons">group</span>
        <p>{{ 'drawerPetFriends.empty' | translate }}</p>
        <p class="subtext">{{ 'drawerPetFriends.emptySubtext' | translate }}</p>
      </div>
    }

    <!-- Friends List -->
    @else {
      <ul class="friends-list">
        @for (friend of friends(); track friend.id) {
          <li class="friend-card" (click)="viewProfile(friend)">
            <div class="friend-card__avatar">
              @if (friend.userAvatar) {
                <img [src]="friend.userAvatar" [alt]="friend.userName" loading="lazy" />
              } @else {
                <span class="friend-card__initials">{{ getInitials(friend.userName) }}</span>
              }
              <span class="friend-card__status-indicator" [class.friend-card__status-indicator--online]="friend.isOnline"></span>
            </div>
            <div class="friend-card__content">
              <div class="friend-card__header">
                <h3 class="friend-card__name">{{ friend.userName }}</h3>
                @if (friend.isOnline) {
                  <span class="friend-card__online-badge">{{ 'drawerPetFriends.online' | translate }}</span>
                } @else if (friend.lastSeen) {
                  <span class="friend-card__last-seen">{{ formatLastSeen(friend.lastSeen) }}</span>
                }
              </div>
              @if (friend.location) {
                <div class="friend-card__location">
                  <span class="material-icons">location_on</span>
                  {{ friend.location }}
                </div>
              }
              <div class="friend-card__pets">
                <span class="material-icons friend-card__pets-icon">pets</span>
                <span class="friend-card__pets-list">
                  @for (petName of getPetNames(friend); track petName; let last = $last) {
                    <span class="friend-card__pet">{{ petName }}</span>
                    @if (!last) {
                      <span class="friend-card__pet-separator">,</span>
                    }
                  }
                </span>
                <span class="friend-card__pets-count">({{ friend.pets.length }})</span>
              </div>
              <div class="friend-card__meta">
                <span class="friend-card__friends-since">
                  <span class="material-icons">calendar_today</span>
                  {{ formatFriendsSince(friend.friendsSince) }}
                </span>
                @if (friend.mutualFriends && friend.mutualFriends > 0) {
                  <span class="friend-card__mutual">
                    <span class="material-icons">people</span>
                    {{ 'drawerPetFriends.mutualFriends' | translate: { count: friend.mutualFriends } }}
                  </span>
                }
              </div>
              <div class="friend-card__actions">
                <button class="friend-card__action friend-card__action--message" (click)="sendMessage(friend); $event.stopPropagation()" [attr.aria-label]="'drawerPetFriends.sendMessageAria' | translate">
                  <span class="material-icons">chat</span>
                  {{ 'drawerPetFriends.message' | translate }}
                </button>
                <button class="friend-card__action friend-card__action--pets" (click)="viewPets(friend); $event.stopPropagation()" [attr.aria-label]="'drawerPetFriends.viewPetsAria' | translate">
                  <span class="material-icons">pets</span>
                  {{ 'drawerPetFriends.pets' | translate }}
                </button>
              </div>
            </div>
          </li>
        }
      </ul>
    }
  </main>

</app-tab-page-shell-blue>
