<app-tab-page-shell-drawer
  [title]="pageTitle"
  [showBack]="true"
  (backClicked)="goBack()">

  <main class="adopt-content">
    <!-- Intro -->
    <div class="adopt-intro">
      <span class="material-icons adopt-intro__icon">volunteer_activism</span>
      <p class="adopt-intro__text">{{ 'drawerAdopt.introText' | translate }}</p>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
      <div class="adopt-loading">
        <div class="adopt-loading__spinner"></div>
        <p class="adopt-loading__text">{{ 'drawerAdopt.loading' | translate }}</p>
      </div>
    }

    <!-- Error State -->
    @if (hasError() && !isLoading()) {
      <div class="adopt-error">
        <span class="material-icons adopt-error__icon">error_outline</span>
        <p class="adopt-error__text">{{ 'drawerAdopt.error' | translate }}</p>
        <button class="adopt-error__retry" (click)="retry()">{{ 'drawerAdopt.retry' | translate }}</button>
      </div>
    }

    <!-- Empty State -->
    @if (!isLoading() && !hasError() && adoptionAds().length === 0) {
      <div class="adopt-empty">
        <span class="material-icons adopt-empty__icon">pets</span>
        <p class="adopt-empty__text">{{ 'drawerAdopt.empty' | translate }}</p>
        <p class="adopt-empty__subtext">{{ 'drawerAdopt.emptySubtext' | translate }}</p>
      </div>
    }

    <!-- Adoption Ads List -->
    @if (!isLoading() && !hasError() && adoptionAds().length > 0) {
      <ul class="adopt-list" role="list">
        @for (ad of adoptionAds(); track ad.id) {
          <li
            class="adopt-card"
            [class.adopt-card--expanded]="isExpanded(ad.id)"
            (click)="toggleCard(ad.id)"
            [attr.aria-expanded]="isExpanded(ad.id)"
            role="button"
            tabindex="0"
            (keydown.enter)="toggleCard(ad.id)"
            (keydown.space)="toggleCard(ad.id); $event.preventDefault()">

            <!-- Image Section (always visible) -->
            <div class="adopt-card__image">
              @if (ad.imageUrl) {
                <img [src]="ad.imageUrl" [alt]="ad.petName" />
              } @else {
                <span class="adopt-card__placeholder">{{ getPetTypeIcon(ad.petType) }}</span>
              }
              <span class="adopt-card__status" [class]="getStatusClass(ad.status)">
                {{ getStatusLabel(ad.status) }}
              </span>
              @if (ad.isUrgent) {
                <span class="adopt-card__urgent-badge">{{ 'drawerAdopt.urgent' | translate }}</span>
              }
            </div>

            <!-- Summary Section (always visible) -->
            <div class="adopt-card__content">
              <div class="adopt-card__header">
                <h3 class="adopt-card__name">{{ ad.petName }}</h3>
                <span class="adopt-card__type">
                  <span class="material-icons">{{ getPetTypeIcon(ad.petType) }}</span>
                  {{ ad.breed }}
                </span>
              </div>
              <div class="adopt-card__info">
                <span class="adopt-card__age">
                  <span class="material-icons">cake</span>
                  {{ ad.age }}
                </span>
                <span class="adopt-card__gender">
                  <span class="material-icons">{{ ad.gender === 'male' ? 'male' : 'female' }}</span>
                  {{ (ad.gender === 'male' ? 'drawerAdopt.gender.male' : 'drawerAdopt.gender.female') | translate }}
                </span>
              </div>
              <p class="adopt-card__description">{{ ad.description }}</p>

              <!-- Expand Indicator -->
              <div class="adopt-card__expand-indicator">
                <span class="material-icons adopt-card__chevron">
                  {{ isExpanded(ad.id) ? 'expand_less' : 'expand_more' }}
                </span>
              </div>
            </div>

            <!-- Expanded Details Section -->
            @if (isExpanded(ad.id)) {
              <div class="adopt-card__details">
                <!-- Full Description -->
                <p class="adopt-card__full-description">{{ ad.description }}</p>

                <!-- Info Rows -->
                <div class="adopt-card__info-row">
                  <span class="material-icons">location_on</span>
                  <span>{{ ad.location }}</span>
                </div>

                @if (ad.shelterName) {
                  <div class="adopt-card__info-row">
                    <span class="material-icons">home</span>
                    <span>{{ ad.shelterName }}</span>
                  </div>
                }

                <div class="adopt-card__info-row">
                  <span class="material-icons">schedule</span>
                  <span>{{ formatRelativeTime(ad.publishedAt) }}</span>
                </div>

                @if (ad.contactPhone) {
                  <div class="adopt-card__info-row">
                    <span class="material-icons">phone</span>
                    <span>{{ ad.contactPhone }}</span>
                  </div>
                }

                <!-- Action Buttons -->
                <div class="adopt-card__actions">
                  <button
                    class="adopt-card__contact-btn"
                    (click)="contactOwner(ad); $event.stopPropagation()"
                    [attr.aria-label]="'drawerAdopt.contact' | translate">
                    <span class="material-icons">chat</span>
                    {{ 'drawerAdopt.contact' | translate }}
                  </button>
                </div>
              </div>
            }
          </li>
        }
      </ul>
    }
  </main>

</app-tab-page-shell-drawer>
