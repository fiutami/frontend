<div class="calendar">
  <!-- Header: Back + Title grouped on left, Avatar on right -->
  <header class="calendar__header">
    <div class="calendar__header-left">
      <app-back-button
        variant="solid"
        (clicked)="onBack()">
      </app-back-button>
      <h1 class="calendar__title">Calendario</h1>
    </div>
    <app-avatar-button mode="pet"></app-avatar-button>
  </header>

  <!-- Logo FIUTAMI -->
  <div class="calendar__branding">
    <app-logo variant="color" size="md"></app-logo>
  </div>

  <!-- Month Navigation -->
  <div class="calendar__month-nav">
    <button
      class="calendar__nav-btn"
      (click)="prevMonth()"
      aria-label="Mese precedente">
      <span class="calendar__nav-arrow">&lt;</span>
    </button>
    <span class="calendar__month-name">{{ currentMonthName() }}</span>
    <button
      class="calendar__nav-btn"
      (click)="nextMonth()"
      aria-label="Mese successivo">
      <span class="calendar__nav-arrow">&gt;</span>
    </button>
  </div>

  <!-- Selected Date Display -->
  <div class="calendar__selected-date">
    {{ formattedSelectedDate() }}
  </div>

  <!-- Calendar Grid -->
  <div class="calendar__grid-container">
    <!-- Day Names Header -->
    <div class="calendar__day-names">
      @for (day of dayNames; track day) {
        <div class="calendar__day-name">{{ day }}</div>
      }
    </div>

    <!-- Days Grid -->
    <div class="calendar__days-grid">
      @for (day of calendarDays(); track trackByDay($index, day)) {
        <button
          class="calendar__day"
          [class.calendar__day--other-month]="!day.isCurrentMonth"
          [class.calendar__day--today]="day.isToday"
          [class.calendar__day--selected]="day.isSelected"
          [class.calendar__day--has-events]="day.events.length > 0"
          (click)="selectDay(day)">
          <span class="calendar__day-number">{{ day.dayOfMonth }}</span>
          @if (day.events.length > 0) {
            <div class="calendar__day-dots">
              @for (event of day.events.slice(0, 3); track event.id) {
                <span
                  class="calendar__day-dot"
                  [style.background-color]="eventColors[event.type]">
                </span>
              }
            </div>
          }
        </button>
      }
    </div>
  </div>

  <!-- Action Row: Crea evento + Campanella notifiche -->
  <div class="calendar__action-row">
    <button
      class="calendar__create-event-btn"
      (click)="onCreateEvent()">
      Crea evento
    </button>
    <button
      class="calendar__notification-btn"
      [class.calendar__notification-btn--active]="isNotificationsOpen()"
      (click)="onNotificationsClick()"
      aria-label="Notifiche">
      <span class="material-icons">notifications</span>
      @if (notificationCount() > 0) {
        <span class="calendar__notification-badge">{{ notificationCount() }}</span>
      }
    </button>
  </div>

  <!-- Events Section - Only visible if there are events -->
  @if (selectedDayEvents().length > 0) {
    <div class="calendar__events-section">
      <div class="calendar__events-header">
        <h2 class="calendar__events-title">Eventi del giorno</h2>
      </div>
      <div class="calendar__events-list">
        @for (event of selectedDayEvents(); track trackByEvent($index, event)) {
          <button
            class="calendar__event-card"
            (click)="onEventClick(event)">
            <div
              class="calendar__event-icon"
              [style.background-color]="eventColors[event.type]">
              {{ getEventIcon(event.type) }}
            </div>
            <div class="calendar__event-info">
              <span class="calendar__event-title">{{ event.title }}</span>
              <span class="calendar__event-meta">
                @if (event.time) {
                  <span class="calendar__event-time">{{ event.time }}</span>
                }
                @if (event.petName) {
                  <span class="calendar__event-pet">{{ event.petName }}</span>
                }
              </span>
            </div>
            <span class="calendar__event-arrow">&gt;</span>
          </button>
        }
      </div>
    </div>
  }

  <!-- Mascotte FIUTO -->
  <app-mascot-peek></app-mascot-peek>

  <!-- Bottom Tab Bar -->
  <app-bottom-tab-bar [tabs]="tabs" [activeTabId]="'calendar'"></app-bottom-tab-bar>
</div>
