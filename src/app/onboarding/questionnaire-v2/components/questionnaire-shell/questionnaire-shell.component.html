<!-- Questionnaire Shell - Quiz Style (3 questions per step) -->
<div class="quiz">

  <!-- Loading State -->
  @if (isInitializing()) {
    <div class="quiz__loading">
      <div class="quiz__spinner"></div>
      <p>{{ 'common.loading' | translate }}</p>
    </div>
  } @else {

    <!-- Header -->
    <header class="quiz__header">
      <button
        class="quiz__back-btn"
        (click)="onBack()"
        [attr.aria-label]="'common.back' | translate"
      >
        <span class="icon">‚Üê</span>
      </button>

      <!-- Progress indicator -->
      <div class="quiz__progress-text">
        {{ 'quiz.phase' | translate }} {{ currentStep() }}/{{ totalSteps() }}
      </div>
    </header>

    <!-- Progress bar -->
    <div class="quiz__progress-bar">
      <div
        class="quiz__progress-fill"
        [style.width.%]="progress()">
      </div>
    </div>

    <!-- Main content -->
    @if (currentQuestion(); as question) {
      <main class="quiz__content">
        <!-- Phase title / Module -->
        @if (moduleTitle()) {
          <div class="quiz__phase-title">
            {{ moduleTitle() }}
          </div>
        }

        <!-- Single Question (compact layout) -->
        <div class="quiz__question-container">
          <h1 class="quiz__question">
            {{ questionText() }}
          </h1>

          @if (hintText()) {
            <p class="quiz__hint">{{ hintText() }}</p>
          }

          <!-- Answer options -->
          <div class="quiz__options" [class.quiz__options--grid]="isGridLayout()">
            @for (option of question.options; track option.id) {
              <button
                type="button"
                class="quiz__option"
                [class.quiz__option--card]="question.visualization === 'cards'"
                (click)="onOptionSelected(option)"
              >
                @if (option.icon) {
                  <span class="quiz__option-icon">{{ option.icon }}</span>
                }
                <span class="quiz__option-label">{{ getOptionLabel(option) }}</span>
                @if (getOptionDescription(option)) {
                  <span class="quiz__option-desc">{{ getOptionDescription(option) }}</span>
                }
              </button>
            }
          </div>
        </div>

        <!-- Dots indicator -->
        <div class="quiz__dots">
          @for (dot of stepDots(); track $index) {
            <span
              class="quiz__dot"
              [class.quiz__dot--active]="dot.active"
              [class.quiz__dot--completed]="dot.completed">
            </span>
          }
        </div>
      </main>
    }

    <!-- Completion State -->
    @if (isComplete()) {
      <main class="quiz__content quiz__content--center">
        <div class="quiz__completion">
          <div class="quiz__completion-icon">üéâ</div>
          <h2>{{ 'questionnaire.completed.title' | translate }}</h2>
          <p>{{ 'questionnaire.completed.message' | translate }}</p>
          <div class="quiz__spinner"></div>
        </div>
      </main>
    }

    <!-- Error State -->
    @if (error()) {
      <div class="quiz__error">
        <div class="quiz__error-icon">‚ö†Ô∏è</div>
        <p>{{ error() | translate }}</p>
        <button class="quiz__btn" (click)="dismissError()">
          {{ 'common.retry' | translate }}
        </button>
      </div>
    }

    <!-- Footer -->
    <footer class="quiz__footer">
      <img
        src="assets/images/logo-fiutami.png"
        alt="FiutaMi"
        class="quiz__footer-logo"
        (error)="onLogoError($event)" />
    </footer>

  }
</div>
